# 03. ãƒãƒ¼ãƒ ç®¡ç†

## æ¦‚è¦

æ±æ–¹BIGé‡çƒã¾ã¨ã‚ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹ãƒãƒ¼ãƒ ç®¡ç†æ©Ÿèƒ½ã¯ã€ãƒãƒ¼ãƒ ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã€ãŠã‚ˆã³ãƒãƒ¼ãƒ ã«æ‰€å±ã™ã‚‹é¸æ‰‹ï¼ˆãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ï¼‰ã®ç®¡ç†ã‚’æ‹…ã†ã€‚ãƒãƒ¼ãƒ ç®¡ç†ã¯ä»¥ä¸‹ã®3ã¤ã®ä¸»è¦ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§æ§‹æˆã•ã‚Œã‚‹:

1. **ãƒãƒ¼ãƒ ï¼ˆTeamï¼‰**: åå‰ãƒ»ç•¥ç§°ãƒ»æ´»å‹•çŠ¶æ…‹ã‚’æŒã¤åŸºæœ¬ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€‚ç›£ç£ãƒ»ã‚³ãƒ¼ãƒã¯ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆTeamManagerï¼‰çµŒç”±ã§ç®¡ç†ã™ã‚‹
2. **ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ï¼ˆTeamMembershipï¼‰**: ãƒãƒ¼ãƒ ã¨é¸æ‰‹ã®å¤šå¯¾å¤šé–¢é€£ã‚’ç®¡ç†ã™ã‚‹ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚é¸æ‰‹ã”ã¨ã®ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—é¸æŠï¼ˆ`selected_cost_type`ï¼‰ã€è»åŒºåˆ†ï¼ˆ`squad`: 1è»/2è»ï¼‰ã€ãŠã‚ˆã³ãƒãƒ¼ãƒ åˆè¨ˆã‚³ã‚¹ãƒˆè¨ˆç®—ã‹ã‚‰ã®é™¤å¤–ãƒ•ãƒ©ã‚°ï¼ˆ`excluded_from_team_total`ï¼‰ã‚’ä¿æŒã™ã‚‹
3. **ãƒãƒ¼ãƒ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆTeamManagerï¼‰**: ãƒãƒ¼ãƒ ã¨ç›£ç£ï¼ˆManagerï¼‰ã®é–¢é€£ã‚’ç®¡ç†ã™ã‚‹ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚å½¹å‰²ï¼ˆ`role`: director/coachï¼‰ã‚’enumã§åŒºåˆ¥ã—ã€åŒä¸€ãƒªãƒ¼ã‚°å†…ã§ã®å…¼ä»»ç¦æ­¢ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒã¤

ãƒãƒ¼ãƒ ç®¡ç†æ©Ÿèƒ½ã¯ä»¥ä¸‹ã®ç”»é¢ã§æ§‹æˆã•ã‚Œã‚‹:

- **ãƒˆãƒƒãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆTopMenuï¼‰**: ã‚«ãƒ¼ãƒ‰å‹ãƒãƒ¼ãƒ é¸æŠUIã€‚ãƒãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§ã‚·ãƒ¼ã‚ºãƒ³ç”»é¢ã¸é·ç§»ã€‚ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆãƒˆã‚°ãƒ«ã‚ã‚Š
- **ãƒãƒ¼ãƒ ä¸€è¦§ç”»é¢ï¼ˆTeamListï¼‰**: å…¨ãƒãƒ¼ãƒ ã®è¡¨ç¤ºãƒ»ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã€‚ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã‚ã‚Š
- **ãƒãƒ¼ãƒ ä½œæˆ/ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆTeamDialogï¼‰**: ãƒãƒ¼ãƒ ã®åå‰ãƒ»ç•¥ç§°ãƒ»ç›£ç£ãƒ»ã‚³ãƒ¼ãƒãƒ»æ´»å‹•çŠ¶æ…‹ã‚’è¨­å®š
- **ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ï¼ˆTeamMembersï¼‰**: é¸æ‰‹ã®è¿½åŠ ãƒ»å‰Šé™¤ã€ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—é¸æŠã€é™¤å¤–ãƒ•ãƒ©ã‚°ã€ç·ã‚³ã‚¹ãƒˆç®¡ç†
- **TeamNavigation**: ãƒãƒ¼ãƒ é–¢é€£ç”»é¢é–“ã®ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

ã•ã‚‰ã«ã€ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒªãƒ¼ã‚°ç®¡ç†ï¼‰ã§ã¯ä»¥ä¸‹ã®è¿½åŠ ç®¡ç†æ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã‚‹:

- **ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç”¨ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ç®¡ç†**: squad/ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã®å€‹åˆ¥æ›´æ–°ãƒ»å‰Šé™¤
- **ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç”¨ãƒãƒ¼ãƒ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ç®¡ç†**: ç›£ç£ãƒ»ã‚³ãƒ¼ãƒã®å€‹åˆ¥CRUD

---

## ãƒãƒ¼ãƒ ç™»éŒ²ç”»é¢ã¨å‡ºå ´é¸æ‰‹ç™»éŒ²ç”»é¢ã®é•ã„

ãƒãƒ¼ãƒ ç™»éŒ²ç”»é¢ï¼ˆTeamMembers.vueï¼‰ã¨å‡ºå ´é¸æ‰‹ç™»éŒ²ç”»é¢ï¼ˆActiveRoster.vueï¼‰ã¯æ©Ÿèƒ½ãŒä¼¼ã¦ã„ã‚‹ãŒã€ç®¡ç†ã™ã‚‹æ¦‚å¿µã¨é©ç”¨ã•ã‚Œã‚‹åˆ¶é™ãŒç•°ãªã‚‹ã€‚é–‹ç™ºæ™‚ã®æ··ä¹±ã‚’é¿ã‘ã‚‹ãŸã‚ã€ã“ã“ã§ä¸¡è€…ã®é•ã„ã‚’æ˜ç¢ºã«ã™ã‚‹ã€‚

### ç”»é¢ã®å½¹å‰²åŒºåˆ†

| | ãƒãƒ¼ãƒ ç™»éŒ²ç”»é¢ | å‡ºå ´é¸æ‰‹ç™»éŒ²ç”»é¢ |
|---|------------|--------------|
| ç›®çš„ | ãƒãƒ¼ãƒ ã®æ‰€å±é¸æ‰‹ã‚’ç®¡ç† | 1è»/2è»ã®ãƒ­ãƒ¼ã‚¹ã‚¿ãƒ¼ã‚’ç®¡ç† |
| æ¦‚å¿µ | çƒå›£ã®ä¿æœ‰é¸æ‰‹ | 1è»å‡ºå ´ç™»éŒ² |
| å¯¾è±¡ | ãƒãƒ¼ãƒ å…¨ä½“ | 1è»ãƒ¡ãƒ³ãƒãƒ¼ |

### å„ç”»é¢ã«é©ç”¨ã•ã‚Œã‚‹åˆ¶é™

| åˆ¶é™ | ãƒãƒ¼ãƒ ç™»éŒ²ç”»é¢ | å‡ºå ´é¸æ‰‹ç™»éŒ²ç”»é¢ |
|------|:---:|:---:|
| ãƒãƒ¼ãƒ å…¨ä½“ã‚³ã‚¹ãƒˆä¸Šé™ï¼ˆ200ï¼‰ | âœ“ | - |
| ãƒãƒ¼ãƒ å…¨ä½“äººæ•°åˆ¶é™ | âœ“ | - |
| é™¤å¤–ãƒ•ãƒ©ã‚°ï¼ˆè¨ˆç®—é™¤å¤–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ | âœ“ | - |
| 1è»äººæ•°åˆ¥ã‚³ã‚¹ãƒˆä¸Šé™ï¼ˆæ®µéšåˆ¶ï¼‰ | - | âœ“ |
| å¤–ã®ä¸–ç•Œæ ï¼ˆæœ€å¤§4äººï¼‰ | - | âœ“ |
| åŒæ—¥ç™»éŒ²å–ã‚Šæ¶ˆã—ï¼ˆã‚¯ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ å…é™¤ï¼‰ | - | âœ“ |
| å…¥ã‚Œæ›¿ãˆæ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | - | âœ“ |

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ ã®èª¬æ˜

ã€Œãƒãƒ¼ãƒ ã«æ‰€å±ã—ã¦ã„ã‚‹ã€ã¨ã€Œ1è»ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã€ã¯åˆ¥ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã‚ã‚‹:

- **ãƒ¬ã‚¤ãƒ¤ãƒ¼1: ãƒãƒ¼ãƒ æ‰€å±**ï¼ˆãƒãƒ¼ãƒ ç™»éŒ²ç”»é¢ã§ç®¡ç†ï¼‰
  - ãƒãƒ¼ãƒ ãŒä¿æœ‰ã™ã‚‹å…¨é¸æ‰‹ã‚’ç®¡ç†
  - `team_memberships` ãƒ†ãƒ¼ãƒ–ãƒ«ã§è¨˜éŒ²
  - ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚³ã‚¹ãƒˆä¸Šé™ï¼ˆ200ï¼‰ã‚’é©ç”¨

- **ãƒ¬ã‚¤ãƒ¤ãƒ¼2: 1è»/2è»ç™»éŒ²**ï¼ˆå‡ºå ´é¸æ‰‹ç™»éŒ²ç”»é¢ã§ç®¡ç†ï¼‰
  - ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®é¸æ‰‹ã®ä¸­ã‹ã‚‰ã€1è»ãƒ¡ãƒ³ãƒãƒ¼ã‚’é¸æŠ
  - `season_rosters` ãƒ†ãƒ¼ãƒ–ãƒ«ã§å±¥æ­´ç®¡ç†
  - 1è»äººæ•°åˆ¥ã‚³ã‚¹ãƒˆä¸Šé™ï¼ˆæ®µéšåˆ¶ï¼‰ã‚’é©ç”¨

é¸æ‰‹ã¯ã¾ãšãƒãƒ¼ãƒ ã«æ‰€å±ã—ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼1ï¼‰ã€ãã®ä¸­ã‹ã‚‰1è»ãƒ¡ãƒ³ãƒãƒ¼ãŒé¸ã°ã‚Œã‚‹ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼2ï¼‰ã€‚ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®åˆ¶é™ã¯ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®åˆ¶é™ã¨ã¯ç‹¬ç«‹ã—ã¦ã„ã‚‹ã€‚

è©³ç´°ã¯ `09_roster_management.md` ã‚’å‚ç…§ã€‚

---

## ç”»é¢æ§‹æˆï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰

### ãƒãƒ¼ãƒ ä¸€è¦§ç”»é¢ï¼ˆTeamListï¼‰

**ãƒ‘ã‚¹:** `/teams`

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:** `src/views/TeamList.vue`

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒãƒ¼ãƒ ä¸€è¦§                                   [+ ãƒãƒ¼ãƒ ã‚’è¿½åŠ ]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ID â”‚ ãƒãƒ¼ãƒ å â”‚ ç•¥ç§° â”‚ ç›£ç£å â”‚ æ´»å‹•ä¸­ â”‚ æ“ä½œ                  â”‚
â”‚  1  â”‚ ç´…é­”é¤¨   â”‚ SDM  â”‚ éœŠå¤¢   â”‚   âœ“   â”‚ [ãƒ¡ãƒ³ãƒãƒ¼][ç·¨é›†][å‰Šé™¤] â”‚
â”‚  2  â”‚ ç™½ç‰æ¥¼   â”‚ WHT  â”‚ é­”ç†æ²™ â”‚   âœ“   â”‚ [ãƒ¡ãƒ³ãƒãƒ¼][ç·¨é›†][å‰Šé™¤] â”‚
â”‚  3  â”‚ æ°¸é äº­   â”‚ EIT  â”‚ -      â”‚       â”‚ [ãƒ¡ãƒ³ãƒãƒ¼][ç·¨é›†][å‰Šé™¤] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼å®šç¾©:**

| ãƒ˜ãƒƒãƒ€ãƒ¼ | ã‚­ãƒ¼ | ã‚½ãƒ¼ãƒˆ | èª¬æ˜ |
|---------|------|--------|------|
| ID | `id` | å¯ | ãƒãƒ¼ãƒ ID |
| ãƒãƒ¼ãƒ å | `name` | å¯ | ãƒãƒ¼ãƒ æ­£å¼åç§° |
| ç•¥ç§° | `short_name` | å¯ | ãƒãƒ¼ãƒ ç•¥ç§° |
| ç›£ç£å | `manager_name` | ä¸å¯ | ç›£ç£ã®åå‰ï¼ˆã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ­ãƒƒãƒˆã§ `item.director?.name` ã‚’è¡¨ç¤ºï¼‰ |
| æ´»å‹•ä¸­ | `is_active` | ä¸å¯ | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ©ã‚°ï¼ˆ`mdi-check` ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºï¼‰ |
| æ“ä½œ | `actions` | ä¸å¯ | ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ãƒ»ãƒãƒ¼ãƒ ç·¨é›†ãƒ»å‰Šé™¤ã‚¢ã‚¤ã‚³ãƒ³ |

**æ“ä½œã‚¢ã‚¤ã‚³ãƒ³:**

| ã‚¢ã‚¤ã‚³ãƒ³ | å‹•ä½œ |
|---------|------|
| `mdi-account-group` | ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ï¼ˆ`/teams/:teamId/members`ï¼‰ã¸é·ç§»ã€‚`navigateToMembers(item.id)` ã§ `router.push` |
| `mdi-pencil` | ãƒãƒ¼ãƒ ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆ`TeamDialog`ï¼‰ã‚’é–‹ãã€‚`openDialog(item)` ã§æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ã‚³ãƒ”ãƒ¼ã‚’æ¸¡ã™ |
| `mdi-delete` | `ConfirmDialog` ã§ç¢ºèªå¾Œã€`DELETE /api/v1/teams/:id` ã‚’å®Ÿè¡Œ |

**ãƒ‡ãƒ¼ã‚¿å–å¾—:**
```typescript
const fetchTeams = async () => {
  loading.value = true
  try {
    const response = await axios.get<Team[]>('/teams')
    teams.value = response.data
  } catch (error) {
    console.error('Error fetching teams:', error)
    showSnackbar(t('teamList.fetchFailed'), 'error')
  } finally {
    loading.value = false
  }
}
```

- ãƒã‚¦ãƒ³ãƒˆæ™‚ï¼ˆ`onMounted`ï¼‰ã«è‡ªå‹•å–å¾—
- ãƒãƒ¼ãƒ ä¿å­˜å®Œäº†ï¼ˆ`TeamDialog` ã® `save` ã‚¤ãƒ™ãƒ³ãƒˆï¼‰æ™‚ã«å†å–å¾—
- ãƒãƒ¼ãƒ å‰Šé™¤å®Œäº†æ™‚ã«å†å–å¾—

**å‰Šé™¤ãƒ•ãƒ­ãƒ¼:**
```
[1] deleteTeam(id) å‘¼ã³å‡ºã—
       â†“
[2] ConfirmDialog.open() ã§ç¢ºèªè¡¨ç¤ºï¼ˆcolor: 'error'ï¼‰
       â†“
[3] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰¿èª â†’ DELETE /api/v1/teams/:id å®Ÿè¡Œ
       â†“
[4] æˆåŠŸæ™‚: ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼è¡¨ç¤º + fetchTeams() ã§ä¸€è¦§å†å–å¾—
       â†“
[5] å¤±æ•—æ™‚: ã‚¨ãƒ©ãƒ¼ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼è¡¨ç¤º
```

**ãƒ€ã‚¤ã‚¢ãƒ­ã‚°åˆ¶å¾¡:**
```typescript
const openDialog = (team: Team | null = null) => {
  editingTeam.value = team ? { ...team } : null // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ§‹æ–‡ã§ã‚³ãƒ”ãƒ¼ï¼ˆå‚ç…§æ¸¡ã—é˜²æ­¢ï¼‰
  dialogVisible.value = true
}
```

**ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³:**
```typescript
const navigateToMembers = (teamId: number) => {
  router.push(`/teams/${teamId}/members`)
}
```

**å›½éš›åŒ–ã‚­ãƒ¼:**
- `teamList.title`: ç”»é¢ã‚¿ã‚¤ãƒˆãƒ«
- `teamList.addTeam`: è¿½åŠ ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«
- `teamList.headers.*`: ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼å„é …ç›®ï¼ˆid, name, shortName, managerName, isActive, actionsï¼‰
- `teamList.noData`: ãƒ‡ãƒ¼ã‚¿ãªã—æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- `teamList.deleteConfirmTitle` / `deleteConfirmMessage`: å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- `teamList.deleteSuccess` / `deleteFailed` / `fetchFailed`: æ“ä½œçµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

---

### ãƒãƒ¼ãƒ ä½œæˆ/ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆTeamDialogï¼‰

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:** `src/components/TeamDialog.vue`

**ç”¨é€”:** ãƒãƒ¼ãƒ ã®æ–°è¦ä½œæˆãŠã‚ˆã³æ—¢å­˜ãƒãƒ¼ãƒ ã®ç·¨é›†

**ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:**
```
+â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€+
|  ãƒãƒ¼ãƒ ã‚’è¿½åŠ  / ãƒãƒ¼ãƒ ã‚’ç·¨é›†      |
|                                  |
|  åå‰:        [________________] |
|  ç•¥ç§°:        [________________] |
|  ç›£ç£:        [â–¼ éœŠå¤¢        ]   |
|  ã‚³ãƒ¼ãƒ:      [â–¼ é­”ç†æ²™, æ—©è‹—]   |
|  [âœ“] æ´»å‹•ä¸­                       |
|                                  |
|          [ã‚­ãƒ£ãƒ³ã‚»ãƒ«] [ä¿å­˜]      |
+â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€+
```

**Propsï¼ˆ`TeamDialog.vue:79-89`ï¼‰:**

| Prop | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|-----|---------|------|
| `isVisible` | `boolean` | `false` | ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºãƒ•ãƒ©ã‚°ï¼ˆv-modelå¯¾å¿œï¼‰ |
| `team` | `Team \| null` | `null` | ç·¨é›†å¯¾è±¡ã®ãƒãƒ¼ãƒ ï¼ˆ`null`ã§æ–°è¦ä½œæˆï¼‰ |
| `defaultManagerId` | `number \| null` | `null` | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç›£ç£IDï¼ˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ä¸€è¦§ã‹ã‚‰é·ç§»æ™‚ã«ä½¿ç”¨ï¼‰ |

**Emits:**
- `update:isVisible`: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºçŠ¶æ…‹ã®å¤‰æ›´
- `save`: ä¿å­˜å®Œäº†é€šçŸ¥ï¼ˆè¦ªãŒ `fetchTeams()` ã‚’å†å®Ÿè¡Œï¼‰

**ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰:**

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | v-model | å‹ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|-----------|---------|------|-------------|------|
| åå‰ | `editedTeam.name` | `v-text-field` | `required`ï¼ˆç©ºæ–‡å­—ä¸å¯ï¼‰ | ãƒãƒ¼ãƒ æ­£å¼åç§° |
| ç•¥ç§° | `editedTeam.short_name` | `v-text-field` | ãªã— | ãƒãƒ¼ãƒ ç•¥ç§°ï¼ˆä»»æ„ï¼‰ |
| ç›£ç£ | `editedTeam.director_id` | `v-autocomplete` | ãªã— | ç›£ç£ï¼ˆManagerãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰é¸æŠï¼‰ã€‚`defaultManagerId` è¨­å®šæ™‚ã¯ `readonly` |
| ã‚³ãƒ¼ãƒ | `editedTeam.coach_ids` | `v-autocomplete (multiple)` | ãªã— | ã‚³ãƒ¼ãƒï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰ |
| æ´»å‹•ä¸­ | `editedTeam.is_active` | `v-checkbox` | ãªã— | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ©ã‚°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `true`ï¼‰ |

**å†…éƒ¨çŠ¶æ…‹ï¼ˆEditedTeamå‹ã€`TeamDialog.vue:98-104`ï¼‰:**
```typescript
interface EditedTeam {
  name: string;
  short_name: string;
  is_active: boolean;
  director_id?: number | null;
  coach_ids?: number[];
}
```

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ`TeamDialog.vue:119-123`ï¼‰:**
```typescript
const rules = {
  required: (value: string) => !!value || t('validation.required'),
};
const isFormValid = computed(() => !!editedTeam.value.name);
```
- ä¿å­˜ãƒœã‚¿ãƒ³ã¯ `isFormValid` ãŒ `false` ã®å ´åˆã« `:disabled` ã§ç„¡åŠ¹åŒ–

**å‹•ä½œãƒ•ãƒ­ãƒ¼ï¼ˆ`TeamDialog.vue:135-153`ï¼‰:**

1. **æ–°è¦ä½œæˆ**ï¼ˆ`props.team` ãŒ `null`ï¼‰:
   - ã‚¿ã‚¤ãƒˆãƒ«: `t('teamDialog.title.add')`
   - `editedTeam` ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§åˆæœŸåŒ–: `{ name: '', short_name: '', is_active: true, director_id: null, coach_ids: [] }`
   - `defaultManagerId` ãŒã‚ã‚Œã° `director_id` ã«è¨­å®š
   - ä¿å­˜: `POST /api/v1/teams` ã« `{ team: teamData }` ã‚’é€ä¿¡

2. **ç·¨é›†**ï¼ˆ`props.team` ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰:
   - ã‚¿ã‚¤ãƒˆãƒ«: `t('teamDialog.title.edit')`
   - `editedTeam` ã‚’ `props.team` ã‹ã‚‰åˆæœŸåŒ–:
     - `director_id`: `props.team.director?.id`
     - `coach_ids`: `props.team.coaches?.map(c => c.id) ?? []`
   - ä¿å­˜: `PATCH /api/v1/teams/:id` ã« `{ team: teamData }` ã‚’é€ä¿¡

3. ä¿å­˜æˆåŠŸæ™‚: `save` ã‚¤ãƒ™ãƒ³ãƒˆã‚’ emit â†’ è¦ªãŒ `fetchTeams()` å®Ÿè¡Œ â†’ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°é–‰ã˜ã‚‹

4. ä¿å­˜å¤±æ•—æ™‚: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ã§è¡¨ç¤º
   - `error.response.data.errors` ãŒé…åˆ—ã®å ´åˆã€æ”¹è¡ŒåŒºåˆ‡ã‚Šã§é€£çµã—ã¦è¡¨ç¤º

**ç›£ç£ãƒ»ã‚³ãƒ¼ãƒé¸æŠè‚¢ã®å–å¾—ï¼ˆ`TeamDialog.vue:125-133`ï¼‰:**
```typescript
const fetchManagers = async () => {
  const response = await axios.get<Manager[]>('/managers');
  managers.value = response.data;
};
```
- ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºæ™‚ï¼ˆ`watch(() => props.isVisible)`ï¼‰ã« `managers.value.length === 0` ã®ã¨ãã®ã¿å–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰

**defaultManagerId ã® watchï¼ˆ`TeamDialog.vue:155-159`ï¼‰:**
- `defaultManagerId` ãŒå¤‰æ›´ã•ã‚Œã€æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€`editedTeam.director_id` ã‚’è‡ªå‹•è¨­å®šï¼ˆ`immediate: true`ï¼‰

**å›½éš›åŒ–ã‚­ãƒ¼:**
- `teamDialog.title.add` / `teamDialog.title.edit`: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚¿ã‚¤ãƒˆãƒ«
- `teamDialog.form.name` / `shortName` / `director` / `coaches` / `isActive`: ãƒ•ã‚©ãƒ¼ãƒ ãƒ©ãƒ™ãƒ«
- `teamDialog.notifications.addSuccess` / `updateSuccess`: ä¿å­˜æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- `teamDialog.notifications.saveFailed` / `saveFailedWithErrors` / `fetchManagersFailed`: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

---

### ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ï¼ˆTeamMembersï¼‰

**ãƒ‘ã‚¹:** `/teams/:teamId/members`

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:** `src/views/TeamMembers.vue`

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†] [å‡ºå ´é¸æ‰‹ç™»éŒ²] [ã‚·ãƒ¼ã‚ºãƒ³] [é›¢è„±å±¥æ­´]  â† TeamNavigation â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç´…é­”é¤¨ã®ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã‚³ã‚¹ãƒˆä¸€è¦§è¡¨: [â–¼ 2025å¹´åº¦ã‚³ã‚¹ãƒˆè¡¨]                            â”‚
â”‚  é¸æ‰‹é¸æŠ:     [â–¼ 00 éœ§é›¨é­”ç†æ²™   ] [è¿½åŠ ]                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§                                            â”‚
â”‚  åˆè¨ˆ: 25/50 äºº / ç·ã‚³ã‚¹ãƒˆ: 180/200                            â”‚
â”‚  âš  ã‚³ã‚¹ãƒˆä¸Šé™ã‚’è¶…ãˆã¦ã„ã¾ã™ï¼ˆè­¦å‘Šã‚¢ãƒ©ãƒ¼ãƒˆã€è¶…éæ™‚ã®ã¿è¡¨ç¤ºï¼‰      â”‚
â”‚  [æŠ•æ‰‹: 10] [æ•æ‰‹: 3] [å†…é‡æ‰‹: 8] [å¤–é‡æ‰‹: 4]                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èƒŒç•ªå· â”‚ åå‰   â”‚ ã‚¿ã‚¤ãƒ— â”‚ å®ˆå‚™ â”‚ æŠ• â”‚ æ‰“ â”‚ ã‚³ã‚¹ãƒˆ   â”‚é™¤å¤–â”‚ æ“ä½œâ”‚
â”‚ 00     â”‚ é­”ç†æ²™ â”‚ äºŒåˆ€æµ â”‚ P    â”‚ å³ â”‚ å³ â”‚[â–¼é€šå¸¸ 10]â”‚[ ]â”‚ [Ã—]â”‚
â”‚ 01     â”‚ éœŠå¤¢   â”‚ é‡æ‰‹å°‚ â”‚ C    â”‚ å³ â”‚ å³ â”‚[â–¼é€šå¸¸ 8] â”‚[âœ“]â”‚ [Ã—]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                       [ã‚­ãƒ£ãƒ³ã‚»ãƒ«] [ä¿å­˜]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸»è¦ãªæ©Ÿèƒ½:**

1. **TeamNavigation**: `TeamNavigation` å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ˆã‚Šã€ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ãƒ»å‡ºå ´é¸æ‰‹ç™»éŒ²ãƒ»ã‚·ãƒ¼ã‚ºãƒ³ãƒãƒ¼ã‚¿ãƒ«ãƒ»é›¢è„±å±¥æ­´ã®å„ç”»é¢é–“ã‚’ã‚¿ãƒ–ã§é·ç§»å¯èƒ½
2. **ã‚³ã‚¹ãƒˆä¸€è¦§è¡¨ã®é¸æŠ**: `CostListSelect` å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§é¸æŠã€‚ãƒã‚¦ãƒ³ãƒˆæ™‚ã«ç¾åœ¨æ—¥æ™‚ãŒæœŸé–“å†…ã®ã‚³ã‚¹ãƒˆè¡¨ã‚’è‡ªå‹•é¸æŠã€‚é¸æŠå¤‰æ›´æ™‚ã« `watch` ã§å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—
3. **é¸æ‰‹ã®è¿½åŠ **: é¸æŠä¸­ã‚³ã‚¹ãƒˆä¸€è¦§è¡¨ã« `normal_cost` ãŒ null ã§ãªã„é¸æ‰‹ã®ã¿å€™è£œã«è¡¨ç¤ºã€‚ã™ã§ã«ãƒãƒ¼ãƒ ã«è¿½åŠ æ¸ˆã¿ã®é¸æ‰‹ã¯é™¤å¤–
4. **ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã®é¸æŠ**: é¸æ‰‹ã”ã¨ã« `normal_cost`, `relief_only_cost`, `pitcher_only_cost`, `fielder_only_cost`, `two_way_cost` ã‹ã‚‰é¸æŠï¼ˆé¸æ‰‹ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¿ã‚¤ãƒ—IDã«å¿œã˜ã¦é¸æŠè‚¢ãŒå‹•çš„ã«å¤‰ã‚ã‚‹ï¼‰
5. **é™¤å¤–ãƒ•ãƒ©ã‚°ï¼ˆ`excluded_from_team_total`ï¼‰**: é¸æ‰‹ã”ã¨ã«ãƒãƒ¼ãƒ åˆè¨ˆã‚³ã‚¹ãƒˆè¨ˆç®—ã‹ã‚‰é™¤å¤–ã™ã‚‹ã‹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€‚é™¤å¤–ã•ã‚ŒãŸé¸æ‰‹ã¯ã‚³ã‚¹ãƒˆåˆè¨ˆãƒ»äººæ•°åˆè¨ˆã«å«ã¾ã‚Œãªã„
6. **åˆ¶é™ãƒã‚§ãƒƒã‚¯**:
   - æœ€å¤§é¸æ‰‹æ•°: `MAX_PLAYERS = 50`ï¼ˆé™¤å¤–ãƒ•ãƒ©ã‚°ãŒfalseã®é¸æ‰‹ã®ã¿ã‚«ã‚¦ãƒ³ãƒˆï¼‰
   - ç·ã‚³ã‚¹ãƒˆä¸Šé™: `TOTAL_TEAM_MAX_COST = 200`ï¼ˆé™¤å¤–ãƒ•ãƒ©ã‚°ãŒfalseã®é¸æ‰‹ã®ã¿è¨ˆç®—ï¼‰
   - è¶…éæ™‚ã¯ `v-alert`ï¼ˆtype="warning"ï¼‰ã§ç”»é¢ä¸Šéƒ¨ã«è­¦å‘Šè¡¨ç¤º
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã‚‚ã‚³ã‚¹ãƒˆä¸Šé™ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œï¼ˆ`cost_list_id` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä½¿ç”¨æ™‚ï¼‰

**ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼å®šç¾©:**

| ãƒ˜ãƒƒãƒ€ãƒ¼ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|------|------|
| èƒŒç•ªå· | `number` | é¸æ‰‹ã®èƒŒç•ªå· |
| åå‰ | `name` | é¸æ‰‹å |
| ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¿ã‚¤ãƒ— | `player_type_ids` | é¸æ‰‹ã‚¿ã‚¤ãƒ—ï¼ˆ`v-chip-group` ã§ãƒãƒƒãƒ—è¡¨ç¤ºã€`playerTypes` ãƒã‚¹ã‚¿ã‹ã‚‰åç§°è§£æ±ºï¼‰ |
| å®ˆå‚™ä½ç½® | `position` | æŠ•æ‰‹ãƒ»æ•æ‰‹ãƒ»å†…é‡æ‰‹ãƒ»å¤–é‡æ‰‹ï¼ˆ`t('baseball.positions.${item.position}')` ã§å›½éš›åŒ–ï¼‰ |
| æŠ• | `throws` | æŠ•çƒè…•ï¼ˆ`t('baseball.throwingHands.${item.throwing_hand}')` ã§å›½éš›åŒ–ï¼‰ |
| æ‰“ | `bats` | æ‰“å¸­ï¼ˆ`t('baseball.battingHands.${item.batting_hand}')` ã§å›½éš›åŒ–ï¼‰ |
| ã‚³ã‚¹ãƒˆ | `cost` | `v-select` ã§ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ |
| é™¤å¤– | `excluded_from_team_total` | ãƒãƒ¼ãƒ åˆè¨ˆã‚³ã‚¹ãƒˆè¨ˆç®—ã‹ã‚‰é™¤å¤–ã™ã‚‹ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼ˆ`v-checkbox`ï¼‰ |
| æ“ä½œ | `actions` | å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆ`mdi-delete`ï¼‰ |

**ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—é¸æŠè‚¢ã®å‹•çš„ç”Ÿæˆ:**

```typescript
const getAvailableCostTypes = (player: Player) => {
  const costPlayerForSelectedList = player.cost_players.find(
    cp => cp.cost_id === selectedCostListId.value
  );
  if (!costPlayerForSelectedList) return [];

  const options: { value: CostType, text: string }[] = [];

  // normal_cost: å€¤ãŒnullã§ãªã‘ã‚Œã°å¸¸ã«è¡¨ç¤º
  addOption('normal_cost', costPlayerForSelectedList.normal_cost);

  // relief_only_cost: player_type_ids ã« 9 ãŒå«ã¾ã‚Œã‚‹å ´åˆ
  if (player.player_type_ids?.includes(9))
    addOption('relief_only_cost', costPlayerForSelectedList.relief_only_cost);

  // pitcher_only_cost / fielder_only_cost: player_type_ids ã« 8 ãŒå«ã¾ã‚Œã‚‹å ´åˆ
  if (player.player_type_ids?.includes(8)) {
    addOption('pitcher_only_cost', costPlayerForSelectedList.pitcher_only_cost);
    addOption('fielder_only_cost', costPlayerForSelectedList.fielder_only_cost);
  }

  // two_way_cost: player_type_ids ã« 2 ãŒå«ã¾ã‚Œã‚‹å ´åˆ
  if (player.player_type_ids?.includes(2))
    addOption('two_way_cost', costPlayerForSelectedList.two_way_cost);

  return options;
};
```

**ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¿ã‚¤ãƒ—ID ã¨ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã®å¯¾å¿œ:**

| player_type_id | æ„å‘³ | è¿½åŠ ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ— |
|---------------|------|---------------|
| 2 | ï¼ˆäºŒåˆ€æµé–¢é€£ï¼‰ | `two_way_cost` |
| 8 | ï¼ˆæŠ•æ‰‹/é‡æ‰‹åˆ‡æ›¿å¯èƒ½ï¼‰ | `pitcher_only_cost`, `fielder_only_cost` |
| 9 | ï¼ˆãƒªãƒªãƒ¼ãƒ•å°‚ç”¨ï¼‰ | `relief_only_cost` |

â€» player_type_ids ã®å®šæ•°å€¤ï¼ˆ2, 8, 9ï¼‰ã®æ„å‘³ã®è©³ç´°ã¯ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ä»•æ§˜ï¼ˆ05_master_data.mdï¼‰å‚ç…§ã€‚

**é¸æ‰‹è¿½åŠ ãƒ•ãƒ­ãƒ¼:**
```
[1] selectedCost ã§æœ‰åŠ¹ãªã‚³ã‚¹ãƒˆä¸€è¦§è¡¨ã‚’é¸æŠï¼ˆæœªé¸æŠæ™‚ã¯é¸æ‰‹é¸æŠãŒ disabledï¼‰
       â†“
[2] availablePlayers ã‹ã‚‰é¸æ‰‹ã‚’é¸æŠ
    ï¼ˆnormal_cost ãŒ null ã§ãªãã€ã‹ã¤ teamPlayers ã«æœªè¿½åŠ ã®é¸æ‰‹ã®ã¿ï¼‰
       â†“
[3] addPlayer() å‘¼ã³å‡ºã—
       â†“
[4] é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆteamPlayers ã«åŒã˜IDã®é¸æ‰‹ãŒã„ãªã„ã‹ç¢ºèªï¼‰
       â†“
[5] initial_cost_type = 'normal_cost', excluded_from_team_total = false ã§ TeamPlayer ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
       â†“
[6] teamPlayers ã«è¿½åŠ  â†’ selectedPlayer ã‚’ã‚¯ãƒªã‚¢
       â†“
[7] äººæ•°åˆ¶é™ãƒã‚§ãƒƒã‚¯ â†’ includedTeamPlayers ã®æ•°ãŒ MAX_PLAYERS è¶…éæ™‚ã¯è­¦å‘Šã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼
[8] ã‚³ã‚¹ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯ â†’ totalTeamCost ãŒ TOTAL_TEAM_MAX_COST è¶…éæ™‚ã¯è­¦å‘Šã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼
```

**åˆæœŸã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—æ±ºå®šãƒ­ã‚¸ãƒƒã‚¯:**

ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼å–å¾—æ™‚ï¼ˆ`fetchTeamPlayers`ï¼‰ã® `selected_cost_type` æ±ºå®šã¯ä»¥ä¸‹ã®å„ªå…ˆé †ä½:

1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰è¿”ã•ã‚ŒãŸ `selected_cost_type` ãŒæœ‰åŠ¹ãªé¸æŠè‚¢ã«å­˜åœ¨ã—ã€å¯¾å¿œã™ã‚‹ã‚³ã‚¹ãƒˆå€¤ãŒ null ã§ãªã‘ã‚Œã°æ¡ç”¨
2. `normal_cost` ãŒ null ã§ãªã‘ã‚Œã° `'normal_cost'` ã‚’æ¡ç”¨
3. ã„ãšã‚Œã‹ã®é¸æŠè‚¢ãŒå­˜åœ¨ã™ã‚Œã°ãã®æœ€åˆã®å€¤ã‚’æ¡ç”¨
4. ã„ãšã‚Œã‚‚ãªã‘ã‚Œã° `'normal_cost'` ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã™ã‚‹

**ä¿å­˜ãƒ•ãƒ­ãƒ¼:**
```
[1] saveTeamMembers() å‘¼ã³å‡ºã—
       â†“
[2] selectedCostListId ãŒ null ãªã‚‰è­¦å‘Šè¡¨ç¤ºã—ã¦ä¸­æ–­
       â†“
[3] payload ç”Ÿæˆ:
    {
      cost_list_id: selectedCostListId.value,
      players: [
        { player_id: 1, selected_cost_type: 'normal_cost', excluded_from_team_total: false },
        { player_id: 2, selected_cost_type: 'relief_only_cost', excluded_from_team_total: true },
        ...
      ]
    }
       â†“
[4] POST /api/v1/teams/:teamId/team_players ã«é€ä¿¡
       â†“
[5] æˆåŠŸæ™‚: ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼è¡¨ç¤º
[6] å¤±æ•—æ™‚: ã‚¨ãƒ©ãƒ¼ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼è¡¨ç¤ºï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚³ã‚¹ãƒˆä¸Šé™ãƒã‚§ãƒƒã‚¯ã§æ‹’å¦ã•ã‚ŒãŸå ´åˆã‚‚å«ã‚€ï¼‰
```

**computed ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£:**

1. **`includedTeamPlayers`**: `excluded_from_team_total` ãŒ `false` ã®ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚’æŠ½å‡ºã€‚äººæ•°åˆ¶é™ãƒ»ã‚³ã‚¹ãƒˆåˆè¨ˆã®ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹
2. **`totalTeamCost`**: `includedTeamPlayers`ï¼ˆé™¤å¤–ã•ã‚Œã¦ã„ãªã„é¸æ‰‹ã®ã¿ï¼‰ã®ã‚³ã‚¹ãƒˆã‚’åˆç®—ã€‚å„é¸æ‰‹ã® `selected_cost_type` ã¨é¸æŠä¸­ã‚³ã‚¹ãƒˆä¸€è¦§è¡¨IDã«åŸºã¥ã„ã¦ `cost_players` ã‹ã‚‰å®Ÿéš›ã®ã‚³ã‚¹ãƒˆå€¤ã‚’å–å¾—
3. **`isCostOverLimit`**: `totalTeamCost` ãŒ `TEAM_TOTAL_MAX_COST` (200) ã‚’è¶…ãˆã¦ã„ã‚‹ã‹ã®ãƒ–ãƒ¼ãƒ«å€¤ã€‚è¶…éæ™‚ã¯ `v-alert` ã§è­¦å‘Šè¡¨ç¤º
4. **`availablePlayers`**: å…¨é¸æ‰‹ã‹ã‚‰ã€Œé¸æŠä¸­ã‚³ã‚¹ãƒˆä¸€è¦§è¡¨ã«ã‚³ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã€ã‹ã¤ã€Œ`normal_cost` ãŒ null ã§ãªã„ã€ã‹ã¤ã€Œãƒãƒ¼ãƒ æœªè¿½åŠ ã€ã®é¸æ‰‹ã‚’æŠ½å‡º
5. **`positionCounts`**: ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã® `position` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆpitcher, catcher, infielder, outfielderï¼‰ã”ã¨ã®äººæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ

**ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¿ã‚¤ãƒŸãƒ³ã‚°:**

| ã‚¤ãƒ™ãƒ³ãƒˆ | å–å¾—API |
|---------|--------|
| ãƒã‚¦ãƒ³ãƒˆæ™‚ | `fetchTeam()` |
| `selectedCost` å¤‰æ›´æ™‚ï¼ˆ`watch`ï¼‰ | `fetchAllPlayers()` â†’ `fetchTeamPlayers()` â†’ `fetchPlayerTypes()` |

- `fetchTeam()`: `GET /api/v1/teams/:teamId` ã§ãƒãƒ¼ãƒ åŸºæœ¬æƒ…å ±ã‚’å–å¾—
- `fetchAllPlayers()`: `GET /api/v1/team_registration_players` ã§å…¨é¸æ‰‹ä¸€è¦§ã‚’å–å¾—
- `fetchTeamPlayers()`: `GET /api/v1/teams/:teamId/team_players` ã§ãƒãƒ¼ãƒ æ‰€å±é¸æ‰‹ã‚’å–å¾—
- `fetchPlayerTypes()`: `GET /api/v1/player-types` ã§ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¿ã‚¤ãƒ—ãƒã‚¹ã‚¿ã‚’å–å¾—

**å›½éš›åŒ–ã‚­ãƒ¼:**
- `teamMembers.title`: ç”»é¢ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ`{ teamName }` ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ï¼‰
- `teamMembers.selectCostList` / `selectPlayer` / `addPlayer`: ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ©ãƒ™ãƒ«
- `teamMembers.teamMembersTitle`: ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«
- `teamMembers.totalCount` / `totalCost`: åˆè¨ˆè¡¨ç¤ºï¼ˆ`{ count, max }`, `{ cost, max }` ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ï¼‰
- `teamMembers.headers.*`: ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼å„é …ç›®
- `teamMembers.costTypes.*`: ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—åï¼ˆ`normal_cost`, `relief_only_cost` ç­‰ï¼‰
- `teamMembers.notifications.*`: å„ç¨®é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- `teamMembers.unknownType`: ä¸æ˜ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¿ã‚¤ãƒ—ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

---

### TeamNavigationï¼ˆãƒãƒ¼ãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:** `src/components/TeamNavigation.vue`

**ç”¨é€”:** ãƒãƒ¼ãƒ é–¢é€£ç”»é¢é–“ã®ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã€‚ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ãƒ»å‡ºå ´é¸æ‰‹ç™»éŒ²ãƒ»ã‚·ãƒ¼ã‚ºãƒ³ãƒãƒ¼ã‚¿ãƒ«ãƒ»é›¢è„±å±¥æ­´ã®å„ç”»é¢ã§å…±é€šä½¿ç”¨ã€‚

**Props:**

| Prop | å‹ | èª¬æ˜ |
|------|-----|------|
| `teamId` | `number \| string` | ãƒãƒ¼ãƒ ID |

**ã‚¿ãƒ–æ§‹æˆ:**

| ã‚¿ãƒ– | ãƒ«ãƒ¼ãƒˆå | ã‚¢ã‚¤ã‚³ãƒ³ | é·ç§»å…ˆ |
|------|---------|---------|--------|
| ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç† | `TeamMembers` | `mdi-account-group` | `/teams/:teamId/members` |
| å‡ºå ´é¸æ‰‹ç™»éŒ² | `SeasonRoster` | `mdi-clipboard-list` | `/teams/:teamId/roster` |
| ã‚·ãƒ¼ã‚ºãƒ³ | `SeasonPortal` | `mdi-calendar` | `/teams/:teamId/season` |
| é›¢è„±å±¥æ­´ | `PlayerAbsenceHistory` | `mdi-account-off` | `/teams/:teamId/absences` |

**å®Ÿè£…:**
```vue
<v-card variant="outlined" class="mb-2">
  <v-tabs :model-value="activeTab" color="primary" density="comfortable">
    <v-tab v-for="tab in tabs" :key="tab.routeName" :value="tab.routeName"
           :to="tab.to" :prepend-icon="tab.icon">
      {{ tab.label }}
    </v-tab>
  </v-tabs>
</v-card>
```

- `activeTab` ã¯ `route.name` ã‹ã‚‰ç¾åœ¨ã®ã‚¿ãƒ–ã‚’è‡ªå‹•åˆ¤å®š
- å„ã‚¿ãƒ–ã¯ `vue-router` ã® `:to` ã§ç›´æ¥é·ç§»ï¼ˆSPAå†…ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- å›½éš›åŒ–ã‚­ãƒ¼: `teamNavigation.teamMembers`, `teamNavigation.activeRoster`, `teamNavigation.seasonPortal`, `teamNavigation.playerAbsenceHistory`

---

### ãƒˆãƒƒãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒãƒ¼ãƒ é¸æŠUIï¼ˆTopMenuï¼‰

**ãƒ‘ã‚¹:** `/` (ãƒ«ãƒ¼ãƒˆ)

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:** `src/views/TopMenu.vue`

**ãƒãƒ¼ãƒ é¸æŠãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒãƒ¼ãƒ é¸æŠ                            â”‚
â”‚ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼: åšéº—éœŠå¤¢               â”‚
â”‚                                      â”‚
â”‚ [ğŸ›¡ ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ãƒ¢ãƒ¼ãƒ‰ (ãƒˆã‚°ãƒ«)]     â”‚
â”‚ [ğŸ›¡ ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç”»é¢]               â”‚
â”‚                                      â”‚
â”‚ [ç´…é­”é¤¨] [ç™½ç‰æ¥¼] [æ°¸é äº­] [å®ˆçŸ¢]    â”‚  â† ã‚«ãƒ¼ãƒ‰å‹ãƒœã‚¿ãƒ³
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ãƒ¢ãƒ¼ãƒ‰:**
- `isCommissioner` ãŒtrueã®å ´åˆã«è¡¨ç¤ºã•ã‚Œã‚‹ `v-switch`
- ONæ™‚: å…¨ãƒãƒ¼ãƒ ï¼ˆ`allTeams`ï¼‰ã‚’è¡¨ç¤ºã€‚OFFæ™‚: ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰€å±ãƒãƒ¼ãƒ ï¼ˆ`teams`ï¼‰ã®ã¿è¡¨ç¤º
- çŠ¶æ…‹ã¯ `localStorage('commissionerMode')` ã«æ°¸ç¶šåŒ–

**ãƒãƒ¼ãƒ é¸æŠå‹•ä½œ:**
```typescript
const selectTeam = (team: Team) => {
  selectedTeam.value = team
  localStorage.setItem('selectedTeamId', String(team.id))
  if (team.has_season) {
    router.push({ name: 'SeasonPortal', params: { teamId: team.id } })
  } else {
    seasonInitializationDialog.value = true
  }
}
```

- ãƒãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯æ™‚: `has_season` ãŒtrueãªã‚‰ã‚·ãƒ¼ã‚ºãƒ³ãƒãƒ¼ã‚¿ãƒ«ç”»é¢ã«ç›´æ¥é·ç§»ã€falseãªã‚‰ã‚·ãƒ¼ã‚ºãƒ³åˆæœŸåŒ–ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
- é¸æŠçŠ¶æ…‹ã¯ `localStorage('selectedTeamId')` ã«æ°¸ç¶šåŒ–ã€‚ç”»é¢å†èª­ã¿è¾¼ã¿æ™‚ã«å¾©å…ƒ

---

## APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### 1. ãƒãƒ¼ãƒ ä¸€è¦§å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /api/v1/teams`

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼:** `Api::V1::TeamsController#index`

**èªè¨¼:** å¿…è¦ï¼ˆ`ApplicationController` ã®èªè¨¼ï¼‰

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:** ãªã—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ200 OKï¼‰:**
```json
[
  {
    "id": 1,
    "name": "ç´…é­”é¤¨",
    "short_name": "SDM",
    "is_active": true,
    "has_season": false,
    "director": {
      "id": 1,
      "name": "åšéº—éœŠå¤¢",
      "role": "director"
    },
    "coaches": [
      {
        "id": 2,
        "name": "éœ§é›¨é­”ç†æ²™",
        "role": "coach"
      }
    ]
  }
]
```

**å‡¦ç†:**
```ruby
# app/controllers/api/v1/teams_controller.rb:7-10
def index
  @teams = Team.preload(:director, :coaches).all
  render json: @teams, each_serializer: TeamSerializer
end
```

- `preload(:director, :coaches)` ã§N+1ã‚¯ã‚¨ãƒªã‚’é˜²æ­¢
- `TeamSerializer` ã§ `id`, `name`, `short_name`, `is_active`, `has_season`, `director`, `coaches` ã‚’å‡ºåŠ›

---

### 2. ãƒãƒ¼ãƒ è©³ç´°å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /api/v1/teams/:id`

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼:** `Api::V1::TeamsController#show`

**èªè¨¼:** å¿…è¦

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ200 OKï¼‰:** ãƒãƒ¼ãƒ ä¸€è¦§å–å¾—ã¨åŒã˜å½¢å¼ã®å˜ä¸€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ404 Not Foundï¼‰:**
```json
{
  "error": "Team not found"
}
```

**å‡¦ç†:**
```ruby
# app/controllers/api/v1/teams_controller.rb:13-15, 47-51
def show
  render json: @team, serializer: TeamSerializer
end

def set_team
  @team = Team.includes(:director, :coaches).find(params[:id])
rescue ActiveRecord::RecordNotFound
  render json: { error: 'Team not found' }, status: :not_found
end
```

- `includes(:director, :coaches)` ã§Eager Loadingã‚’é©ç”¨
- `ActiveRecord::RecordNotFound` ã‚’ rescue ã—ã¦404ã‚’è¿”å´

---

### 3. ãƒãƒ¼ãƒ ä½œæˆ

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /api/v1/teams`

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼:** `Api::V1::TeamsController#create`

**èªè¨¼:** å¿…è¦

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "team": {
    "name": "å®ˆçŸ¢ç¥ç¤¾",
    "short_name": "MRY",
    "is_active": true,
    "director_id": 3,
    "coach_ids": [4, 5]
  }
}

```

**è¨±å¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ`teams_controller.rb:53-55`ï¼‰:**
```ruby
def team_params
  params.require(:team).permit(:name, :short_name, :is_active, :director_id, coach_ids: [])
end
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ201 Createdï¼‰:** TeamSerializerã®å‡ºåŠ›ï¼ˆãƒãƒ¼ãƒ è©³ç´°ã¨åŒå½¢å¼ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ422 Unprocessable Entityï¼‰:**
```json
{
  "errors": ["Name can't be blank"]
}
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**
```
[1] team_params ã‹ã‚‰ director_id, coach_ids ã‚’é™¤å¤–ã—ã¦ Team.new
       â†“
[2] team.save å®Ÿè¡Œ
       â†“
[3a] ä¿å­˜æˆåŠŸæ™‚:
       â†’ update_managers(team, director_id, coach_ids) ã§ç›£ç£ãƒ»ã‚³ãƒ¼ãƒã‚’è¨­å®š
       â†’ 201 Created ã§ TeamSerializer ã®çµæœã‚’è¿”å´
[3b] ä¿å­˜å¤±æ•—æ™‚:
       â†’ 422 Unprocessable Entity ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…åˆ—ã‚’è¿”å´
```

---

### 4. ãƒãƒ¼ãƒ æ›´æ–°

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `PATCH /api/v1/teams/:id` ã¾ãŸã¯ `PUT /api/v1/teams/:id`

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼:** `Api::V1::TeamsController#update`

**èªè¨¼:** å¿…è¦

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:** ãƒãƒ¼ãƒ ä½œæˆã¨åŒå½¢å¼

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ200 OKï¼‰:** TeamSerializerã®å‡ºåŠ›

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ422 Unprocessable Entityï¼‰:** ãƒãƒ¼ãƒ ä½œæˆã¨åŒå½¢å¼ã®ã‚¨ãƒ©ãƒ¼

**å‡¦ç†:**
```ruby
# app/controllers/api/v1/teams_controller.rb:30-37
def update
  if @team.update(team_params.except(:director_id, :coach_ids))
    update_managers(@team, team_params[:director_id], team_params[:coach_ids])
    render json: @team, serializer: TeamSerializer
  else
    render json: { errors: @team.errors.full_messages }, status: :unprocessable_entity
  end
end
```

---

### 5. ãƒãƒ¼ãƒ å‰Šé™¤

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `DELETE /api/v1/teams/:id`

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼:** `Api::V1::TeamsController#destroy`

**èªè¨¼:** å¿…è¦

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ204 No Contentï¼‰:** ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ãªã—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ404 Not Foundï¼‰:**
```json
{
  "error": "Team not found"
}
```

**å‡¦ç†:**
```ruby
# app/controllers/api/v1/teams_controller.rb:40-43
def destroy
  @team.destroy
  head :no_content
end
```

**å‰Šé™¤æ™‚ã®åˆ¶ç´„:**
- `Team` ãƒ¢ãƒ‡ãƒ«ã® `has_one :season, dependent: :restrict_with_error` ã«ã‚ˆã‚Šã€ã‚·ãƒ¼ã‚ºãƒ³ãŒç´ã¥ã„ã¦ã„ã‚‹å ´åˆã¯å‰Šé™¤ä¸å¯ï¼ˆ`ActiveRecord::DeleteRestrictionError` ãŒç™ºç”Ÿï¼‰
- ç¾åœ¨ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã¯ã“ã®ã‚¨ãƒ©ãƒ¼ã‚’ rescue ã—ã¦ã„ãªã„ãŸã‚ã€500 Internal Server Error ãŒè¿”å´ã•ã‚Œã‚‹

---

### 6. ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆé¸æ‰‹ï¼‰ä¸€è¦§å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /api/v1/teams/:team_id/team_players`

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼:** `Api::V1::TeamPlayersController#index`

**èªè¨¼:** å¿…è¦

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `cost_list_id`ï¼ˆä»»æ„ï¼‰: ã‚³ã‚¹ãƒˆä¸€è¦§è¡¨ã®IDã€‚ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã§ `current_cost` è¨ˆç®—ã«ä½¿ç”¨

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹:**
```
GET /api/v1/teams/1/team_players?cost_list_id=3
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ200 OKï¼‰:**
```json
[
  {
    "id": 1,
    "name": "éœ§é›¨é­”ç†æ²™",
    "number": "00",
    "short_name": "é­”ç†æ²™",
    "position": "pitcher",
    "player_type_ids": [2, 8],
    "throwing_hand": "right",
    "batting_hand": "right",
    "defense_p": "S",
    "defense_c": null,
    "defense_1b": null,
    "defense_2b": "C",
    "defense_3b": "B",
    "defense_ss": "D",
    "defense_of": "A",
    "defense_lf": "A",
    "defense_cf": "A",
    "defense_rf": "A",
    "throwing_c": null,
    "throwing_of": "85",
    "throwing_lf": "85",
    "throwing_cf": "85",
    "throwing_rf": "85",
    "cost_players": [
      {
        "id": 10,
        "cost_id": 3,
        "player_id": 1,
        "normal_cost": 10,
        "relief_only_cost": null,
        "pitcher_only_cost": 8,
        "fielder_only_cost": 7,
        "two_way_cost": 12
      }
    ],
    "selected_cost_type": "normal_cost",
    "current_cost": 10,
    "excluded_from_team_total": false
  }
]
```

**å‡¦ç†:**
```ruby
def index
  cost_list_id = params[:cost_list_id]
  players = @team.players
  render json: players, each_serializer: TeamPlayerSerializer, team: @team, cost_list_id: cost_list_id
end
```

**TeamPlayerSerializerï¼ˆ`app/serializers/team_player_serializer.rb`ï¼‰:**
```ruby
class TeamPlayerSerializer < PlayerSerializer
  attributes :selected_cost_type, :current_cost, :excluded_from_team_total

  def selected_cost_type
    object.team_memberships.find_by(team_id: @instance_options[:team].id).selected_cost_type
  end

  def current_cost
    cost_type = object.team_memberships.find_by(team_id: @instance_options[:team].id).selected_cost_type
    cost_player_record = object.cost_players.find_by(cost_id: @instance_options[:cost_list_id])
    cost_player_record&.send(cost_type)
  end

  def excluded_from_team_total
    object.team_memberships.find_by(team_id: @instance_options[:team].id).excluded_from_team_total
  end
end
```

- `PlayerSerializer` ã‚’ç¶™æ‰¿ã—ã€`selected_cost_type`ã€`current_cost`ã€`excluded_from_team_total` ã‚’è¿½åŠ 
- `selected_cost_type`: è©²å½“ãƒãƒ¼ãƒ ã® `TeamMembership` ã‹ã‚‰å–å¾—
- `current_cost`: `selected_cost_type` ã¨ `cost_list_id` ã«åŸºã¥ã„ã¦ `CostPlayer` ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã‚³ã‚¹ãƒˆå€¤ã‚’å‹•çš„å–å¾—ï¼ˆ`send` ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚«ãƒ©ãƒ åã‚’å‹•çš„æŒ‡å®šï¼‰
- `excluded_from_team_total`: è©²å½“ãƒãƒ¼ãƒ ã® `TeamMembership` ã‹ã‚‰é™¤å¤–ãƒ•ãƒ©ã‚°ã‚’å–å¾—

**PlayerSerializerï¼ˆ`app/serializers/player_serializer.rb`ï¼‰:**
```ruby
class PlayerSerializer < ActiveModel::Serializer
  attributes :id, :name, :number, :short_name, :position, :player_type_ids, :throwing_hand, :batting_hand,
             :defense_p, :defense_c, :defense_1b, :defense_2b, :defense_3b, :defense_ss,
             :defense_of, :defense_lf, :defense_cf, :defense_rf,
             :throwing_c, :throwing_of, :throwing_lf, :throwing_cf, :throwing_rf

  has_many :cost_players, serializer: CostPlayerSerializer

  def player_type_ids
    object.player_player_types.pluck(:player_type_id)
  end
end
```

---

### 7. ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ä¸€æ‹¬æ›´æ–°

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `POST /api/v1/teams/:team_id/team_players`

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼:** `Api::V1::TeamPlayersController#create`

**èªè¨¼:** å¿…è¦

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "cost_list_id": 3,
  "players": [
    { "player_id": 1, "selected_cost_type": "normal_cost", "excluded_from_team_total": false },
    { "player_id": 2, "selected_cost_type": "relief_only_cost", "excluded_from_team_total": true },
    { "player_id": 3, "selected_cost_type": "two_way_cost", "excluded_from_team_total": false }
  ]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ200 OKï¼‰:**
```json
{
  "message": "Team members updated successfully"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ422 Unprocessable Entityï¼‰:**
```json
{
  "error": "ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚³ã‚¹ãƒˆãŒä¸Šé™ã‚’è¶…ãˆã¦ã„ã¾ã™ï¼ˆã‚³ã‚¹ãƒˆ: 210, ä¸Šé™: 200ï¼‰"
}
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**
```
[1] params.require(:players) ã§ players é…åˆ—ã‚’å–å¾—
       â†“
[2] incoming_player_ids ã¨ã—ã¦ player_id ã®é…åˆ—ã‚’æŠ½å‡º
       â†“
[3] ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
       â†“
[4] incoming_player_ids ã«å«ã¾ã‚Œãªã„æ—¢å­˜ã® TeamMembership ã‚’ destroy_all
       â†“
[5] å„ player ã«ã¤ã„ã¦:
    - find_or_initialize_by(player_id) ã§æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰æ¤œç´¢ or æ–°è¦åˆæœŸåŒ–
    - update!(selected_cost_type, excluded_from_team_total) ã§æ›´æ–°
       â†“
[6] cost_list_id ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒãƒ¼ãƒ åˆè¨ˆã‚³ã‚¹ãƒˆã®ä¸Šé™ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    - @team.validate_team_total_cost(cost_list_id) ã§ãƒãƒ¼ãƒ åˆè¨ˆã‚³ã‚¹ãƒˆä¸Šé™ï¼ˆ200ï¼‰ãƒã‚§ãƒƒã‚¯
    - è¶…éæ™‚ã¯ RecordInvalid ã‚’ raise ã—ã¦ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
       â†“
[7] ã‚³ãƒŸãƒƒãƒˆæˆåŠŸ â†’ 200 OK
[8] ActiveRecord::RecordInvalid â†’ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ â†’ 422 Unprocessable Entity
```

**å®Ÿè£…ã‚³ãƒ¼ãƒ‰ï¼ˆ`app/controllers/api/v1/team_players_controller.rb`ï¼‰:**
```ruby
def create
  player_params = params.require(:players)
  cost_list_id = params[:cost_list_id]&.to_i
  incoming_player_ids = player_params.map { |p| p[:player_id] }

  ActiveRecord::Base.transaction do
    @team.team_memberships.where.not(player_id: incoming_player_ids).destroy_all

    player_params.each do |p|
      membership = @team.team_memberships.find_or_initialize_by(player_id: p[:player_id])
      membership.update!(
        selected_cost_type: p[:selected_cost_type],
        excluded_from_team_total: p[:excluded_from_team_total] || false
      )
    end

    # Validate team total cost limit (200 fixed) after all memberships are updated
    @team.team_memberships.reload
    if cost_list_id
      unless @team.validate_team_total_cost(cost_list_id)
        raise ActiveRecord::RecordInvalid.new(@team)
      end
    end
  end

  render json: { message: "Team members updated successfully" }, status: :ok
rescue ActiveRecord::RecordInvalid => e
  render json: { error: e.record&.errors&.full_messages&.join(", ") || e.message }, status: :unprocessable_entity
end
```

**é‡è¦ãªæ³¨æ„ç‚¹:**
- ã“ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯**ä¸€æ‹¬ç½®æ›**æ–¹å¼ã§å‹•ä½œã™ã‚‹ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã¾ã‚Œãªã„æ—¢å­˜ãƒ¡ãƒ³ãƒãƒ¼ã¯å‰Šé™¤ã•ã‚Œã‚‹
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ä¿å­˜æ™‚ã«å…¨ãƒ¡ãƒ³ãƒãƒ¼ã‚’é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- `cost_list_id` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ãƒãƒ¼ãƒ åˆè¨ˆã‚³ã‚¹ãƒˆä¸Šé™ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«ä½¿ç”¨ã•ã‚Œã‚‹
- `excluded_from_team_total` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§é™¤å¤–ãƒ•ãƒ©ã‚°ã‚’è¨­å®šã§ãã‚‹ï¼ˆæœªæŒ‡å®šæ™‚ã¯ `false`ï¼‰
- `squad` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯æ›´æ–°ã•ã‚Œãªã„ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ `"second"` ã®ã¾ã¾ï¼‰

---

### 8. ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ä¸€è¦§å–å¾—ï¼ˆå®ˆå‚™é©æ€§æƒ…å ±ä»˜ãï¼‰

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** `GET /api/v1/teams/:team_id/team_memberships`

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼:** `Api::V1::TeamMembershipsController#index`

**èªè¨¼:** å¿…è¦

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ200 OKï¼‰:**
```json
[
  {
    "id": 1,
    "name": "00 éœ§é›¨é­”ç†æ²™",
    "player_id": 1,
    "defense_p": "S",
    "defense_c": null,
    "defense_1b": null,
    "defense_2b": "C",
    "defense_3b": "B",
    "defense_ss": "D",
    "defense_of": "A",
    "defense_lf": "A",
    "defense_cf": "A",
    "defense_rf": "A",
    "throwing_c": null,
    "throwing_of": "85",
    "throwing_lf": "85",
    "throwing_cf": "85",
    "throwing_rf": "85"
  }
]
```

**å‡¦ç†ï¼ˆ`app/controllers/api/v1/team_memberships_controller.rb:4-34`ï¼‰:**

```ruby
def index
  team = Team.find(params[:team_id])
  team_memberships = team.team_memberships.preload(:player)

  output = team_memberships.map do |member|
    player = member.player
    {
      id: member.id,
      name: "#{player.number} #{player.name}",
      player_id: player.id,
      defense_p: player.defense_p, defense_c: player.defense_c,
      defense_1b: player.defense_1b, defense_2b: player.defense_2b,
      defense_3b: player.defense_3b, defense_ss: player.defense_ss,
      defense_of: player.defense_of, defense_lf: player.defense_lf,
      defense_cf: player.defense_cf, defense_rf: player.defense_rf,
      throwing_c: player.throwing_c, throwing_of: player.throwing_of,
      throwing_lf: player.throwing_lf, throwing_cf: player.throwing_cf,
      throwing_rf: player.throwing_rf,
    }
  end

  render json: output
end
```

**ç‰¹å¾´:**
- ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã‚’ä½¿ã‚ãšã€ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒã‚·ãƒ¥å½¢å¼ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ§‹ç¯‰
- `name` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ `"#{player.number} #{player.name}"` å½¢å¼ï¼ˆèƒŒç•ªå·ï¼‹åå‰ï¼‰
- å®ˆå‚™é©æ€§ï¼ˆ`defense_*`ï¼‰ã¨é€çƒé©æ€§ï¼ˆ`throwing_*`ï¼‰ã‚’å«ã‚€

**ç”¨é€”:**
- ãƒ­ãƒ¼ã‚¹ã‚¿ãƒ¼ç™»éŒ²ç”»é¢ã‚„ã‚¹ã‚¿ãƒ¡ãƒ³é¸æŠç”»é¢ãªã©ã€å®ˆå‚™é©æ€§æƒ…å ±ãŒå¿…è¦ãªå ´é¢ã§ä½¿ç”¨
- TeamMembers.vueï¼ˆãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ï¼‰ã§ã¯ä½¿ç”¨ã—ã¦ã„ãªã„

---

### 9. ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç”¨ãƒãƒ¼ãƒ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ç®¡ç†

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼:** `Api::V1::Commissioner::TeamManagersController`

**ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹:** `/api/v1/commissioner/leagues/:league_id/teams/:team_id/team_managers`

| HTTPãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|-------------|------|----------|------|
| GET | `/team_managers` | `index` | ãƒãƒ¼ãƒ ã®ç›£ç£ãƒ»ã‚³ãƒ¼ãƒä¸€è¦§å–å¾—ï¼ˆ`includes(:manager)`ï¼‰ |
| GET | `/team_managers/:id` | `show` | å€‹åˆ¥å–å¾— |
| POST | `/team_managers` | `create` | ç›£ç£/ã‚³ãƒ¼ãƒè¿½åŠ ï¼ˆ`manager_id`, `role` ã‚’æŒ‡å®šï¼‰ |
| PATCH | `/team_managers/:id` | `update` | å½¹å‰²å¤‰æ›´ç­‰ |
| DELETE | `/team_managers/:id` | `destroy` | å€‹åˆ¥å‰Šé™¤ |

**è¨±å¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:** `params.require(:team_manager).permit(:manager_id, :role)`

---

### 10. ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç”¨ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ç®¡ç†

**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼:** `Api::V1::Commissioner::TeamMembershipsController`

**ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹:** `/api/v1/commissioner/leagues/:league_id/teams/:team_id/team_memberships`

| HTTPãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|-------------|------|----------|------|
| GET | `/team_memberships` | `index` | ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ä¸€è¦§å–å¾—ï¼ˆ`includes(:player)`ï¼‰ |
| GET | `/team_memberships/:id` | `show` | å€‹åˆ¥å–å¾— |
| PATCH | `/team_memberships/:id` | `update` | squad/selected_cost_type ã®å€‹åˆ¥æ›´æ–° |
| DELETE | `/team_memberships/:id` | `destroy` | å€‹åˆ¥å‰Šé™¤ |

**è¨±å¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:** `params.require(:team_membership).permit(:squad, :selected_cost_type)`

**é€šå¸¸ã®ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ã¨ã®é•ã„:**
- é€šå¸¸ç‰ˆï¼ˆ`TeamPlayersController`ï¼‰ã¯ä¸€æ‹¬ç½®æ›æ–¹å¼
- ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç‰ˆã¯å€‹åˆ¥CRUDæ–¹å¼ï¼ˆç‰¹å®šã®ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ã ã‘ã‚’æ›´æ–°ãƒ»å‰Šé™¤å¯èƒ½ï¼‰
- ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç‰ˆã§ã¯ `squad` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ›´æ–°ã‚‚å¯èƒ½

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### teamsãƒ†ãƒ¼ãƒ–ãƒ«

**ã‚¹ã‚­ãƒ¼ãƒå®šç¾©:**
```ruby
create_table "teams", force: :cascade do |t|
  t.string "name"
  t.string "short_name"
  t.boolean "is_active", default: true
  t.datetime "created_at", null: false
  t.datetime "updated_at", null: false
end
```

**ã‚«ãƒ©ãƒ è©³ç´°:**

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|---------|----|----|----------|------|
| `id` | bigint | NO | AUTO_INCREMENT | ä¸»ã‚­ãƒ¼ |
| `name` | string | YES | - | ãƒãƒ¼ãƒ æ­£å¼åç§° |
| `short_name` | string | YES | - | ãƒãƒ¼ãƒ ç•¥ç§° |
| `is_active` | boolean | YES | `true` | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ãƒ©ã‚° |
| `created_at` | datetime | NO | - | ä½œæˆæ—¥æ™‚ |
| `updated_at` | datetime | NO | - | æ›´æ–°æ—¥æ™‚ |

**å‚™è€ƒ:** æ—§ã‚¹ã‚­ãƒ¼ãƒã«ã‚ã£ãŸ `manager_id` ã‚«ãƒ©ãƒ ã¯å‰Šé™¤æ¸ˆã¿ã€‚ç›£ç£ãƒ»ã‚³ãƒ¼ãƒã®ç®¡ç†ã¯ã™ã¹ã¦ `team_managers` ãƒ†ãƒ¼ãƒ–ãƒ«çµŒç”±ã§è¡Œã†ã€‚

**ãƒ¢ãƒ‡ãƒ«ï¼ˆ`app/models/team.rb`ï¼‰:**
```ruby
class Team < ApplicationRecord
  COST_LIMIT_CONFIG = YAML.load_file(Rails.root.join("config", "cost_limits.yml")).freeze
  TEAM_TOTAL_MAX_COST = COST_LIMIT_CONFIG["team_total_max_cost"]
  OUTSIDE_WORLD_LIMIT = 4

  has_one :season, dependent: :restrict_with_error
  has_many :team_memberships, dependent: :destroy
  has_many :players, through: :team_memberships

  has_many :league_memberships, dependent: :destroy
  has_many :leagues, through: :league_memberships

  has_many :team_managers, dependent: :destroy
  has_one :director_team_manager, -> { where(role: :director) }, class_name: "TeamManager", dependent: :destroy
  has_one :director, through: :director_team_manager, source: :manager
  has_many :coach_team_managers, -> { where(role: :coach) }, class_name: "TeamManager", dependent: :destroy
  has_many :coaches, through: :coach_team_managers, source: :manager

  validates :name, presence: true
end
```

**ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:**

| é–¢é€£å | ç¨®é¡ | å¯¾è±¡ | dependent | èª¬æ˜ |
|--------|------|------|-----------|------|
| `season` | `has_one` | Season | `restrict_with_error` | ãƒãƒ¼ãƒ ã®ã‚·ãƒ¼ã‚ºãƒ³ã€‚å­˜åœ¨æ™‚ã¯å‰Šé™¤ä¸å¯ |
| `team_memberships` | `has_many` | TeamMembership | `destroy` | ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ï¼ˆä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ |
| `players` | `has_many :through` | Player | - | ãƒãƒ¼ãƒ ã«æ‰€å±ã™ã‚‹é¸æ‰‹ |
| `league_memberships` | `has_many` | LeagueMembership | `destroy` | ãƒªãƒ¼ã‚°åŠ ç›Ÿï¼ˆä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ |
| `leagues` | `has_many :through` | League | - | åŠ ç›Ÿãƒªãƒ¼ã‚° |
| `team_managers` | `has_many` | TeamManager | `destroy` | ãƒãƒ¼ãƒ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ |
| `director_team_manager` | `has_one` (scoped) | TeamManager | `destroy` | ç›£ç£ã®TeamManagerãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆ`role: :director` ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼‰ |
| `director` | `has_one :through` | Manager | - | ç›£ç£ |
| `coach_team_managers` | `has_many` (scoped) | TeamManager | `destroy` | ã‚³ãƒ¼ãƒã®TeamManagerãƒ¬ã‚³ãƒ¼ãƒ‰ç¾¤ï¼ˆ`role: :coach` ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼‰ |
| `coaches` | `has_many :through` | Manager | - | ã‚³ãƒ¼ãƒ |

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:**
- `name`: å¿…é ˆï¼ˆ`presence: true`ï¼‰

**ã‚³ã‚¹ãƒˆé–¢é€£ãƒ¡ã‚½ãƒƒãƒ‰:**

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|---------|------|
| `has_season` | ã‚·ãƒ¼ã‚ºãƒ³ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¿”ã™ï¼ˆUIè¡¨ç¤ºç”¨ï¼‰ |
| `validate_team_total_cost(cost_list_id)` | ãƒãƒ¼ãƒ å…¨ä½“ã‚³ã‚¹ãƒˆï¼ˆé™¤å¤–é¸æ‰‹ã‚’é™¤ãï¼‰ãŒä¸Šé™ä»¥ä¸‹ã‹ãƒã‚§ãƒƒã‚¯ã€‚è¶…éæ™‚ã¯ `errors` ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¦ `false` ã‚’è¿”ã™ |
| `outside_world_first_squad_memberships` | 1è»ã®å¤–ã®ä¸–ç•Œæ é¸æ‰‹ï¼ˆ`outside_world` ã‚«ãƒ†ã‚´ãƒªã® `player_type` ã‚’æŒã¤é¸æ‰‹ï¼‰ã‚’è¿”ã™ |
| `validate_outside_world_limit` | å¤–ã®ä¸–ç•Œæ ãŒæœ€å¤§4äººä»¥ä¸‹ã‹ãƒã‚§ãƒƒã‚¯ |
| `validate_outside_world_balance` | å¤–ã®ä¸–ç•Œæ ãŒ4äººã®ã¨ãã€æŠ•æ‰‹/é‡æ‰‹æ··åœ¨å¿…é ˆã‹ãƒã‚§ãƒƒã‚¯ï¼ˆäºŒåˆ€æµã¯ä¸¡æ–¹ã«ã‚«ã‚¦ãƒ³ãƒˆå¯èƒ½ï¼‰ |
| `self.first_squad_cost_limit_for_count(count)` | 1è»ç™»éŒ²äººæ•°ã«å¯¾å¿œã™ã‚‹ã‚³ã‚¹ãƒˆä¸Šé™ã‚’è¿”ã™ |
| `self.first_squad_minimum_players` | 1è»æœ€ä½äººæ•°ã‚’è¿”ã™ |

**ã‚³ã‚¹ãƒˆä¸Šé™è¨­å®š:**
- ãƒãƒ¼ãƒ å…¨ä½“ã‚³ã‚¹ãƒˆä¸Šé™ï¼ˆ`TEAM_TOTAL_MAX_COST`ï¼‰ã¯ `config/cost_limits.yml` ã‹ã‚‰èª­ã¿è¾¼ã‚€
- å¤–ã®ä¸–ç•Œæ ä¸Šé™: `OUTSIDE_WORLD_LIMIT = 4`

**å‰Šé™¤æ™‚ã®æŒ™å‹•:**
- `season` ãŒå­˜åœ¨ â†’ å‰Šé™¤ä¸å¯ï¼ˆ`restrict_with_error`ï¼‰
- `team_memberships`, `league_memberships`, `team_managers` â†’ é€£é–å‰Šé™¤ï¼ˆ`dependent: :destroy`ï¼‰
  - ãŸã ã— `team_memberships` ã« `player_absences` ãŒç´ã¥ã„ã¦ã„ã‚‹å ´åˆã¯ã€ãã¡ã‚‰ã® `restrict_with_error` ã«ã‚ˆã‚Šå‰Šé™¤ãŒå¤±æ•—ã™ã‚‹

---

### team_membershipsãƒ†ãƒ¼ãƒ–ãƒ«

**ã‚¹ã‚­ãƒ¼ãƒå®šç¾©:**
```ruby
create_table "team_memberships", force: :cascade do |t|
  t.bigint "team_id", null: false
  t.bigint "player_id", null: false
  t.string "squad", default: "second", null: false
  t.string "selected_cost_type", default: "normal_cost", null: false
  t.datetime "created_at", null: false
  t.datetime "updated_at", null: false
  t.boolean "excluded_from_team_total", default: false, null: false
  t.index ["player_id"], name: "index_team_memberships_on_player_id"
  t.index ["team_id", "player_id"], name: "index_team_memberships_on_team_id_and_player_id", unique: true
  t.index ["team_id"], name: "index_team_memberships_on_team_id"
end

add_foreign_key "team_memberships", "players"
add_foreign_key "team_memberships", "teams"
```

**ã‚«ãƒ©ãƒ è©³ç´°:**

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|---------|----|----|----------|------|
| `id` | bigint | NO | AUTO_INCREMENT | ä¸»ã‚­ãƒ¼ |
| `team_id` | bigint | NO | - | ãƒãƒ¼ãƒ ID |
| `player_id` | bigint | NO | - | é¸æ‰‹ID |
| `squad` | string | NO | `"second"` | è»åŒºåˆ†ï¼ˆ`"first"` = 1è», `"second"` = 2è»ï¼‰ |
| `selected_cost_type` | string | NO | `"normal_cost"` | é¸æŠã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ— |
| `excluded_from_team_total` | boolean | NO | `false` | ãƒãƒ¼ãƒ åˆè¨ˆã‚³ã‚¹ãƒˆè¨ˆç®—ã‹ã‚‰é™¤å¤–ã™ã‚‹ã‹ã®ãƒ•ãƒ©ã‚° |
| `created_at` | datetime | NO | - | ä½œæˆæ—¥æ™‚ |
| `updated_at` | datetime | NO | - | æ›´æ–°æ—¥æ™‚ |

**selected_cost_type ã®è¨±å®¹å€¤:**
- `normal_cost`: é€šå¸¸ã‚³ã‚¹ãƒˆ
- `relief_only_cost`: ãƒªãƒªãƒ¼ãƒ•å°‚ç”¨ã‚³ã‚¹ãƒˆ
- `pitcher_only_cost`: æŠ•æ‰‹å°‚ç”¨ã‚³ã‚¹ãƒˆ
- `fielder_only_cost`: é‡æ‰‹å°‚ç”¨ã‚³ã‚¹ãƒˆ
- `two_way_cost`: äºŒåˆ€æµã‚³ã‚¹ãƒˆ

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:**
- `index_team_memberships_on_team_id` (team_id)
- `index_team_memberships_on_player_id` (player_id)
- `index_team_memberships_on_team_id_and_player_id` (team_id, player_id) â€” **UNIQUEåˆ¶ç´„**: åŒä¸€ãƒãƒ¼ãƒ ã«åŒä¸€é¸æ‰‹ã®é‡è¤‡ç™»éŒ²ã‚’é˜²æ­¢

**å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„:**
- `team_id` â†’ `teams.id`
- `player_id` â†’ `players.id`

**ãƒ¢ãƒ‡ãƒ«ï¼ˆ`app/models/team_membership.rb`ï¼‰:**
```ruby
class TeamMembership < ApplicationRecord
  belongs_to :team
  belongs_to :player
  has_many :season_rosters
  has_many :player_absences, dependent: :restrict_with_error

  validates :squad, inclusion: { in: %w[first second] }
  validates :selected_cost_type, presence: true,
            inclusion: { in: %w[normal_cost relief_only_cost pitcher_only_cost fielder_only_cost two_way_cost] }

  scope :included_in_team_total, -> { where(excluded_from_team_total: false) }
  scope :excluded_from_team_total, -> { where(excluded_from_team_total: true) }
end
```

**ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:**

| é–¢é€£å | ç¨®é¡ | å¯¾è±¡ | dependent | èª¬æ˜ |
|--------|------|------|-----------|------|
| `team` | `belongs_to` | Team | - | æ‰€å±ãƒãƒ¼ãƒ  |
| `player` | `belongs_to` | Player | - | æ‰€å±é¸æ‰‹ |
| `season_rosters` | `has_many` | SeasonRoster | - | ã‚·ãƒ¼ã‚ºãƒ³ãƒ­ã‚¹ã‚¿ãƒ¼ï¼ˆ1è»/2è»ç™»éŒ²å±¥æ­´ï¼‰ |
| `player_absences` | `has_many` | PlayerAbsence | `restrict_with_error` | é¸æ‰‹é›¢è„±è¨˜éŒ²ï¼ˆå­˜åœ¨æ™‚ã¯å‰Šé™¤ä¸å¯ï¼‰ |

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:**
- `squad`: `"first"` ã¾ãŸã¯ `"second"` ã®ã¿è¨±å¯ï¼ˆ`inclusion`ï¼‰
- `selected_cost_type`: å¿…é ˆï¼ˆ`presence: true`ï¼‰ã‹ã¤è¨±å®¹å€¤ãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹ã“ã¨ï¼ˆ`inclusion`ï¼‰

**ã‚¹ã‚³ãƒ¼ãƒ—:**
- `included_in_team_total`: `excluded_from_team_total` ãŒ `false` ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿å–å¾—ï¼ˆã‚³ã‚¹ãƒˆåˆè¨ˆè¨ˆç®—ã«ä½¿ç”¨ï¼‰
- `excluded_from_team_total`: `excluded_from_team_total` ãŒ `true` ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿å–å¾—

**ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼:**

`TeamMembershipSerializer`ï¼ˆ`app/serializers/team_membership_serializer.rb`ï¼‰:
```ruby
class TeamMembershipSerializer < ActiveModel::Serializer
  attributes :id, :team_id, :player_id, :squad, :selected_cost_type, :excluded_from_team_total
  belongs_to :player
end
```

---

### team_managersãƒ†ãƒ¼ãƒ–ãƒ«

**ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ï¼ˆ`db/schema.rb:331-339`ï¼‰:**
```ruby
create_table "team_managers", force: :cascade do |t|
  t.bigint "team_id", null: false
  t.bigint "manager_id", null: false
  t.integer "role", default: 0, null: false
  t.datetime "created_at", null: false
  t.datetime "updated_at", null: false
  t.index ["manager_id"], name: "index_team_managers_on_manager_id"
  t.index ["team_id"], name: "index_team_managers_on_team_id"
end

add_foreign_key "team_managers", "managers"
add_foreign_key "team_managers", "teams"
```

**ã‚«ãƒ©ãƒ è©³ç´°:**

| ã‚«ãƒ©ãƒ å | å‹ | NULL | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|---------|----|----|----------|------|
| `id` | bigint | NO | AUTO_INCREMENT | ä¸»ã‚­ãƒ¼ |
| `team_id` | bigint | NO | - | ãƒãƒ¼ãƒ ID |
| `manager_id` | bigint | NO | - | ç›£ç£/ã‚³ãƒ¼ãƒID |
| `role` | integer | NO | `0` | å½¹å‰²ï¼ˆenum: `0` = director, `1` = coachï¼‰ |
| `created_at` | datetime | NO | - | ä½œæˆæ—¥æ™‚ |
| `updated_at` | datetime | NO | - | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:**
- `index_team_managers_on_team_id` (team_id)
- `index_team_managers_on_manager_id` (manager_id)

**å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„:**
- `team_id` â†’ `teams.id`
- `manager_id` â†’ `managers.id`

**ãƒ¢ãƒ‡ãƒ«ï¼ˆ`app/models/team_manager.rb`ï¼‰:**
```ruby
class TeamManager < ApplicationRecord
  belongs_to :team
  belongs_to :manager

  enum :role, { director: 0, coach: 1 }

  validates :role, presence: true
  validates :team_id, uniqueness: { scope: :role, if: -> { director? },
    message: 'ã«ã¯æ—¢ã«ç›£ç£ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™' }
  validate :manager_cannot_be_assigned_to_multiple_teams_in_same_league, on: [:create, :update]

  private

  def manager_cannot_be_assigned_to_multiple_teams_in_same_league
    return unless manager_id.present? && team.present?
    current_league = team.leagues.first
    return unless current_league.present?

    other_teams_in_same_league = current_league.teams.where.not(id: team.id)
    if TeamManager.where(manager_id: manager_id, team_id: other_teams_in_same_league.select(:id)).exists?
      errors.add(:manager_id, 'ã¯åŒä¸€ãƒªãƒ¼ã‚°å†…ã®è¤‡æ•°ã®ãƒãƒ¼ãƒ ã«å…¼ä»»ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“')
    end
  end
end
```

**enumå®šç¾©:**
- `role`: `director` (0) / `coach` (1)

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³:**

| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | å¯¾è±¡ | æ¡ä»¶ | èª¬æ˜ |
|-------------|------|------|------|
| `presence` | `role` | å¸¸æ™‚ | å½¹å‰²ã¯å¿…é ˆ |
| `uniqueness` (scope: `:role`) | `team_id` | `director?` ã®å ´åˆã®ã¿ | 1ãƒãƒ¼ãƒ ã«ç›£ç£ã¯1äººã¾ã§ |
| ã‚«ã‚¹ã‚¿ãƒ  | `manager_id` | `create`/`update` æ™‚ | åŒä¸€ãƒªãƒ¼ã‚°å†…ã®è¤‡æ•°ãƒãƒ¼ãƒ ã¸ã®å…¼ä»»ã‚’ç¦æ­¢ |

**åŒä¸€ãƒªãƒ¼ã‚°å…¼ä»»ç¦æ­¢ã®è©³ç´°:**

`manager_cannot_be_assigned_to_multiple_teams_in_same_league` ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚Šã€åŒã˜ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒåŒä¸€ãƒªãƒ¼ã‚°å†…ã®è¤‡æ•°ãƒãƒ¼ãƒ ã®ç›£ç£/ã‚³ãƒ¼ãƒã‚’å…¼ä»»ã™ã‚‹ã“ã¨ãŒç¦æ­¢ã•ã‚Œã‚‹ã€‚å‡¦ç†ãƒ•ãƒ­ãƒ¼:

1. å½“è©²ãƒãƒ¼ãƒ ãŒæ‰€å±ã™ã‚‹ãƒªãƒ¼ã‚°ã‚’å–å¾—ï¼ˆ`team.leagues.first`ï¼‰
2. ãƒªãƒ¼ã‚°ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°ã‚¹ã‚­ãƒƒãƒ—ï¼ˆãƒªãƒ¼ã‚°æœªå‚åŠ ã®ãƒãƒ¼ãƒ ã§ã¯åˆ¶ç´„ãªã—ï¼‰
3. åŒã˜ãƒªãƒ¼ã‚°ã«æ‰€å±ã™ã‚‹ä»–ã®ãƒãƒ¼ãƒ ã‚’å–å¾—
4. ä»–ãƒãƒ¼ãƒ ã«åŒã˜ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒ `TeamManager` ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¦ã„ã‚Œã°ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

**ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼:**

`TeamManagerSerializer`ï¼ˆ`app/serializers/team_manager_serializer.rb`ï¼‰:
```ruby
class TeamManagerSerializer < ActiveModel::Serializer
  attributes :id, :team_id, :manager_id, :role
  belongs_to :manager
end
```

---

### ERå›³ï¼ˆãƒãƒ¼ãƒ ç®¡ç†é–¢é€£ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ managers â”‚     â”‚  team_managers   â”‚     â”‚  teams   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id       â”‚â†â”€â”€â”€â”€â”‚ manager_id       â”‚     â”‚ id       â”‚
â”‚ name     â”‚     â”‚ team_id          â”‚â”€â”€â”€â”€â†’â”‚ name     â”‚
â”‚ short_nameâ”‚    â”‚ role (enum)      â”‚     â”‚short_nameâ”‚
â”‚ irc_name â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚is_active â”‚
â”‚ user_id  â”‚                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ role     â”‚                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
                                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  team_memberships   â”‚     â”‚ players  â”‚
                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                    â”‚ id                  â”‚     â”‚ id       â”‚
                    â”‚ team_id             â”‚     â”‚ name     â”‚
                    â”‚ player_id           â”‚â”€â”€â”€â”€â†’â”‚ number   â”‚
                    â”‚ squad               â”‚     â”‚ position â”‚
                    â”‚ selected_cost_type  â”‚     â”‚ ...      â”‚
                    â”‚excluded_from_team_totalâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

### ãƒãƒ¼ãƒ ä½œæˆãƒ»ç·¨é›†æ™‚ã®ç›£ç£ãƒ»ã‚³ãƒ¼ãƒç®¡ç†

**å®Ÿè£…ï¼ˆ`app/controllers/api/v1/teams_controller.rb:57-71`ï¼‰:**
```ruby
def update_managers(team, director_id, coach_ids)
  team.transaction do
    team.director = director_id.present? ? Manager.find_by(id: director_id) : nil

    team.coach_team_managers.destroy_all
    if coach_ids.present?
      coach_ids.uniq.each do |id|
        team.coach_team_managers.create!(manager_id: id)
      end
    end
  end
rescue ActiveRecord::RecordInvalid => e
  team.errors.add(:base, e.message)
  raise ActiveRecord::Rollback
end
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**
1. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
2. **ç›£ç£ã®è¨­å®š**: `director_id` ãŒå­˜åœ¨ã™ã‚Œã° `Manager.find_by(id:)` ã§æ¤œç´¢ã—ã¦ `team.director =` ã§å‰²ã‚Šå½“ã¦ã€‚å­˜åœ¨ã—ãªã‘ã‚Œã° `nil` ã‚’ä»£å…¥ï¼ˆç›£ç£ãªã—ï¼‰ã€‚æ—¢å­˜ã®ç›£ç£ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ `has_one` ã®è‡ªå‹•å‡¦ç†ã§å‰Šé™¤ã•ã‚Œã‚‹
3. **ã‚³ãƒ¼ãƒã®å†è¨­å®š**: `team.coach_team_managers.destroy_all` ã§æ—¢å­˜ã‚³ãƒ¼ãƒã‚’å…¨å‰Šé™¤ â†’ `coach_ids` ã‹ã‚‰é‡è¤‡å‰Šé™¤ï¼ˆ`uniq`ï¼‰ã—ã¦å„ã‚³ãƒ¼ãƒã® `TeamManager` ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ
4. ã‚¨ãƒ©ãƒ¼æ™‚: `team.errors` ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¦ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

**åˆ¶ç´„:**
- ç›£ç£ï¼ˆdirectorï¼‰ã¯0äººã¾ãŸã¯1äººï¼ˆ`TeamManager` ãƒ¢ãƒ‡ãƒ«ã® `uniqueness` ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚‚ä¿è¨¼ï¼‰
- ã‚³ãƒ¼ãƒï¼ˆcoachï¼‰ã¯è¤‡æ•°äººè¨­å®šå¯èƒ½
- åŒä¸€ãƒªãƒ¼ã‚°å†…ã®å…¼ä»»ç¦æ­¢ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ`TeamManager` ãƒ¢ãƒ‡ãƒ«ï¼‰ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚‹
  - `team.coach_team_managers.create!` ãŒ `RecordInvalid` ã‚’ raise â†’ rescue ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

**æ³¨æ„ç‚¹:**
- `director_id` ã«ç„¡åŠ¹ãªIDã‚’æŒ‡å®šã™ã‚‹ã¨ã€`Manager.find_by` ãŒ `nil` ã‚’è¿”ã™ãŸã‚ç›£ç£ãŒæœªè¨­å®šã«ãªã‚‹ï¼ˆã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ï¼‰
- `coach_ids` ãŒç©ºã¾ãŸã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å«ã¾ã‚Œãªã„å ´åˆã€æ—¢å­˜ã®ã‚³ãƒ¼ãƒãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã‚‹
- ã‚³ãƒ¼ãƒæ›´æ–°ã¯æ¯å›ã€Œå…¨å‰Šé™¤â†’å†ä½œæˆã€æ–¹å¼ã®ãŸã‚ã€æ—¢å­˜ã®ã‚³ãƒ¼ãƒã®IDã¯ä¿æŒã•ã‚Œãªã„

---

### ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã®ä¸€æ‹¬æ›´æ–°

**å‡¦ç†æ¦‚è¦:**

ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ã§ä¿å­˜ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€`teamPlayers` é…åˆ—å…¨ä½“ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«é€ä¿¡ã—ã€`team_memberships` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä¸€æ‹¬ç½®æ›ã™ã‚‹ã€‚

**å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆ`app/controllers/api/v1/team_players_controller.rb:10-28`ï¼‰:**

1. `params.require(:players)` ã§ `players` é…åˆ—ã‚’å–å¾—
2. `incoming_player_ids` ã¨ã—ã¦é€ä¿¡ã•ã‚ŒãŸ `player_id` ã®é…åˆ—ã‚’æŠ½å‡º
3. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
4. `@team.team_memberships.where.not(player_id: incoming_player_ids).destroy_all`: é€ä¿¡ã•ã‚Œãªã‹ã£ãŸæ—¢å­˜ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤
5. `player_params` ã®å„è¦ç´ ã«ã¤ã„ã¦ `find_or_initialize_by(player_id:)` + `update!(selected_cost_type:)` ã§Upsert
6. ã‚³ãƒŸãƒƒãƒˆæˆåŠŸ â†’ æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿”å´
7. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼æ™‚ â†’ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ â†’ 422 è¿”å´

**åˆ¶ç´„:**
- `selected_cost_type` ã¯ `TeamMembership` ãƒ¢ãƒ‡ãƒ«ã® `presence: true` ã§æ¤œè¨¼
- `squad` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯æ›´æ–°ã•ã‚Œãªã„ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ `"second"` ã®ã¾ã¾ã€‚è»åŒºåˆ†ã®å¤‰æ›´ã¯ãƒ­ãƒ¼ã‚¹ã‚¿ãƒ¼ç®¡ç†ç”»é¢ã§è¡Œã†ï¼‰
- `team_memberships` ã« `player_absences` ãŒç´ã¥ã„ã¦ã„ã‚‹å ´åˆã€`destroy_all` ãŒ `restrict_with_error` ã«ã‚ˆã‚Šå¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

---

### ãƒãƒ¼ãƒ å‰Šé™¤æ™‚ã®åˆ¶ç´„

`Team` ãƒ¢ãƒ‡ãƒ«ã® `has_one :season, dependent: :restrict_with_error` ã«ã‚ˆã‚Šã€ãƒãƒ¼ãƒ ã«ç´ã¥ãã‚·ãƒ¼ã‚ºãƒ³ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯å‰Šé™¤ä¸å¯ã€‚

**å½±éŸ¿ã®é€£é–:**
```
Team#destroy å‘¼ã³å‡ºã—
  â”œâ”€â”€ season ãŒå­˜åœ¨ â†’ ActiveRecord::DeleteRestrictionErrorï¼ˆå‰Šé™¤ä¸­æ­¢ï¼‰
  â””â”€â”€ season ãŒä¸åœ¨ â†’ ä»¥ä¸‹ãŒé€£é–å‰Šé™¤:
       â”œâ”€â”€ team_memberships (destroy) â†’ ãŸã ã— player_absences ãŒã‚ã‚‹å ´åˆã¯ restrict_with_error
       â”œâ”€â”€ league_memberships (destroy)
       â””â”€â”€ team_managers (destroy)
```

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…è©³ç´°

### TypeScriptå‹å®šç¾©

**Teamå‹ï¼ˆ`src/types/team.ts`ï¼‰:**
```typescript
import { type Manager } from '@/types/manager'

export interface Team {
  id: number;
  name: string;
  short_name: string;
  is_active: boolean;
  has_season: boolean;
  director?: Manager;
  coaches?: Manager[];
}
```

**Managerå‹ï¼ˆ`src/types/manager.ts`ï¼‰:**
```typescript
import { type Team } from './team';

export interface Manager {
  id: number;
  name: string;
  short_name?: string | null;
  irc_name?: string | null;
  user_id?: string | null;
  teams?: Team[];
  role: 'director' | 'coach';
}
```

**TeamPlayerå‹ï¼ˆ`src/views/TeamMembers.vue` å†…ã§å®šç¾©ï¼‰:**
```typescript
type CostType = 'normal_cost' | 'relief_only_cost' | 'pitcher_only_cost' | 'fielder_only_cost' | 'two_way_cost';

interface TeamPlayer extends Player {
  selected_cost_type: CostType;
  current_cost: number;
  excluded_from_team_total: boolean;
}
```

**Playerå‹ï¼ˆ`src/types/player.ts`ï¼‰:**
```typescript
import type { PlayerCost } from './playerCost';

export interface Player {
  id: number;
  name: string;
  short_name: string;
  number: string;
  position: string;
  throwing_hand: string;
  batting_hand: string;
  player_type_ids: number[];
  cost_players: PlayerCost[];
  defense_p?: string;
  defense_c?: string;
  defense_1b?: string;
  defense_2b?: string;
  defense_3b?: string;
  defense_ss?: string;
  defense_of?: string;
  defense_lf?: string;
  defense_cf?: string;
  defense_rf?: string;
  throwing_c?: number;
  throwing_of?: string;
  throwing_lf?: string;
  throwing_cf?: string;
  throwing_rf?: string;
}
```

**PlayerCostå‹ï¼ˆ`src/types/playerCost.ts`ï¼‰:**
```typescript
export interface PlayerCost {
  id: number;
  cost_id: number;
  player_id: number;
  normal_cost: number | null;
  relief_only_cost: number | null;
  pitcher_only_cost: number | null;
  fielder_only_cost: number | null;
  two_way_cost: number | null;
}
```

**CostListå‹ï¼ˆ`src/types/costList.ts`ï¼‰:**
```typescript
export interface CostList {
  id: number;
  name: string;
  start_date: string | null;
  end_date: string | null;
  effective_date: string | null;
}
```

**PlayerTypeå‹ï¼ˆ`src/types/playerType.ts`ï¼‰:**
```typescript
export interface PlayerType {
  id: number;
  name: string;
  description: string | null;
}
```

---

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

**TeamList.vue:**
- è²¬å‹™: ãƒãƒ¼ãƒ ä¸€è¦§ã®è¡¨ç¤ºã€ãƒãƒ¼ãƒ ä½œæˆãƒ»ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®åˆ¶å¾¡ã€ãƒãƒ¼ãƒ å‰Šé™¤ã€ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- ä½¿ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:
  - `TeamDialog`: ãƒãƒ¼ãƒ ä½œæˆãƒ»ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆ`v-model:isVisible` ã¨ `:team` props ã§åˆ¶å¾¡ï¼‰
  - `ConfirmDialog`: å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆ`ref` ã§ç›´æ¥ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ï¼‰
- çŠ¶æ…‹:
  - `teams: ref<Team[]>([])` â€” ãƒãƒ¼ãƒ ä¸€è¦§
  - `loading: ref(true)` â€” ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹
  - `dialogVisible: ref(false)` â€” ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºãƒ•ãƒ©ã‚°
  - `editingTeam: ref<Team | null>(null)` â€” ç·¨é›†ä¸­ã®ãƒãƒ¼ãƒ ï¼ˆæ–°è¦ä½œæˆæ™‚ã¯ `null`ï¼‰

**TeamDialog.vue:**
- è²¬å‹™: ãƒãƒ¼ãƒ ã®ä½œæˆãƒ»ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºã¨ä¿å­˜
- Props: `isVisible`, `team`, `defaultManagerId`
- Emits: `update:isVisible`, `save`
- çŠ¶æ…‹:
  - `editedTeam: ref<EditedTeam>({...defaultTeam})` â€” ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›å†…å®¹
  - `managers: ref<Manager[]>([])` â€” ç›£ç£ãƒ»ã‚³ãƒ¼ãƒé¸æŠè‚¢ï¼ˆåˆå›è¡¨ç¤ºæ™‚ã«ãƒ•ã‚§ãƒƒãƒã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
  - `isFormValid: computed(() => !!editedTeam.value.name)` â€” ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

**TeamMembers.vue:**
- è²¬å‹™: ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã®ç·¨é›†ã€ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—é¸æŠã€é™¤å¤–ãƒ•ãƒ©ã‚°è¨­å®šã€ç·ã‚³ã‚¹ãƒˆè¨ˆç®—ã€ä¿å­˜
- ä½¿ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:
  - `TeamNavigation`ï¼ˆ`src/components/TeamNavigation.vue`ï¼‰: ãƒãƒ¼ãƒ é–¢é€£ç”»é¢é–“ã®ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
  - `CostListSelect`ï¼ˆ`src/components/shared/CostListSelect.vue`ï¼‰: ã‚³ã‚¹ãƒˆä¸€è¦§è¡¨é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã€‚ãƒã‚¦ãƒ³ãƒˆæ™‚ã« `GET /api/v1/costs` ã§ã‚³ã‚¹ãƒˆè¡¨ä¸€è¦§ã‚’å–å¾—ã—ã€ç¾åœ¨æ—¥æ™‚ãŒå«ã¾ã‚Œã‚‹ã‚³ã‚¹ãƒˆè¡¨ã‚’è‡ªå‹•é¸æŠ
- çŠ¶æ…‹:
  - `team: ref<Partial<Team>>({})` â€” å¯¾è±¡ãƒãƒ¼ãƒ 
  - `allPlayers: ref<Player[]>([])` â€” å…¨é¸æ‰‹ä¸€è¦§ï¼ˆ`GET /api/v1/team_registration_players`ï¼‰
  - `teamPlayers: ref<TeamPlayer[]>([])` â€” ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼
  - `selectedCost: ref<CostList | null>(null)` â€” é¸æŠä¸­ã®ã‚³ã‚¹ãƒˆä¸€è¦§è¡¨
  - `selectedPlayer: ref<Player | null>(null)` â€” è¿½åŠ ã™ã‚‹é¸æ‰‹
  - `playerTypes: ref<PlayerType[]>([])` â€” ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¿ã‚¤ãƒ—ãƒã‚¹ã‚¿
- å®šæ•°:
  - `MAX_PLAYERS = 50`
  - `TOTAL_TEAM_MAX_COST = 200`

---

### çŠ¶æ…‹ç®¡ç†

**èªè¨¼:**
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: ã™ã¹ã¦ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒ `Api::V1::BaseController` ã‚’ç¶™æ‰¿ã—ã€èªè¨¼ã‚¬ãƒ¼ãƒ‰ãŒé©ç”¨ã•ã‚Œã‚‹
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: `useAuth` composable ã§ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç®¡ç†ã€‚ãƒãƒ¼ãƒ ç®¡ç†ç”»é¢ã¯ã™ã¹ã¦ `meta: { requiresAuth: true }` ã§èªè¨¼å¿…é ˆï¼ˆ`authGuard` ã§åˆ¶å¾¡ï¼‰

**ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼é€šçŸ¥:**
- `useSnackbar` composable ã§æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¸€å…ƒè¡¨ç¤º
- `showSnackbar(message, type)` ã® `type`: `'success'` / `'error'` / `'warning'`

---

### APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆAxiosï¼‰

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã® `axios` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ `/api/v1` ã‚’ãƒ™ãƒ¼ã‚¹URLã¨ã—ã¦è¨­å®šã•ã‚Œã¦ãŠã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ã¯ç›¸å¯¾ãƒ‘ã‚¹ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã€‚

```typescript
// ä¾‹:
await axios.get<Team[]>('/teams');           // GET /api/v1/teams
await axios.post('/teams', { team: data });  // POST /api/v1/teams
await axios.patch(`/teams/${id}`, { team }); // PATCH /api/v1/teams/:id
await axios.delete(`/teams/${id}`);          // DELETE /api/v1/teams/:id
```

---

## ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ`config/routes.rb`ï¼‰

**ãƒãƒ¼ãƒ ç®¡ç†é–¢é€£ãƒ«ãƒ¼ãƒˆï¼ˆ`config/routes.rb:23-31`ï¼‰:**
```ruby
resources :teams, only: [:index, :show, :update, :create, :destroy] do
  resource :season, only: [:show, :update], controller: 'team_seasons' do
    patch 'season_schedules/:id', to: 'team_seasons#update_season_schedule'
  end
  resource :roster, only: [:show, :create], controller: 'team_rosters'
  resource :key_player, only: [:create], controller: 'team_key_players'
  resources :team_players, only: [:index, :create]
  resources :team_memberships, only: [:index]
end
```

**ç”Ÿæˆã•ã‚Œã‚‹ãƒ«ãƒ¼ãƒˆä¸€è¦§ï¼ˆãƒãƒ¼ãƒ ç®¡ç†ç›´æ¥é–¢é€£ï¼‰:**

| HTTPãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼#ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|-------------|------|------------------------|
| GET | `/api/v1/teams` | `teams#index` |
| POST | `/api/v1/teams` | `teams#create` |
| GET | `/api/v1/teams/:id` | `teams#show` |
| PATCH/PUT | `/api/v1/teams/:id` | `teams#update` |
| DELETE | `/api/v1/teams/:id` | `teams#destroy` |
| GET | `/api/v1/teams/:team_id/team_players` | `team_players#index` |
| POST | `/api/v1/teams/:team_id/team_players` | `team_players#create` |
| GET | `/api/v1/teams/:team_id/team_memberships` | `team_memberships#index` |

**ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç”¨ãƒ«ãƒ¼ãƒˆï¼ˆ`config/routes.rb:69-84`ï¼‰:**
```ruby
namespace :commissioner do
  resources :leagues do
    resources :teams do
      resources :team_memberships, only: [:index, :update, :destroy] do
        resources :player_absences, only: [:index, :create, :update, :destroy]
      end
      resources :team_managers, only: [:index, :create, :update, :destroy]
    end
  end
end
```

**ç”Ÿæˆã•ã‚Œã‚‹ãƒ«ãƒ¼ãƒˆä¸€è¦§ï¼ˆã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç”¨ï¼‰:**

| HTTPãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼#ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|-------------|------|------------------------|
| GET | `/api/v1/commissioner/leagues/:league_id/teams/:team_id/team_memberships` | `commissioner/team_memberships#index` |
| PATCH | `/api/v1/commissioner/leagues/:league_id/teams/:team_id/team_memberships/:id` | `commissioner/team_memberships#update` |
| DELETE | `/api/v1/commissioner/leagues/:league_id/teams/:team_id/team_memberships/:id` | `commissioner/team_memberships#destroy` |
| GET | `/api/v1/commissioner/leagues/:league_id/teams/:team_id/team_managers` | `commissioner/team_managers#index` |
| POST | `/api/v1/commissioner/leagues/:league_id/teams/:team_id/team_managers` | `commissioner/team_managers#create` |
| PATCH | `/api/v1/commissioner/leagues/:league_id/teams/:team_id/team_managers/:id` | `commissioner/team_managers#update` |
| DELETE | `/api/v1/commissioner/leagues/:league_id/teams/:team_id/team_managers/:id` | `commissioner/team_managers#destroy` |

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆVue Routerï¼‰

**ãƒãƒ¼ãƒ ç®¡ç†é–¢é€£ãƒ«ãƒ¼ãƒˆï¼ˆ`src/router/index.ts`ï¼‰:**

| ãƒ‘ã‚¹ | name | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ¡ã‚¿ |
|------|------|-------------|------|
| `/teams` | `TeamList` | `TeamList.vue`ï¼ˆlazy loadï¼‰ | `requiresAuth: true` |
| `/teams/:teamId/members` | `TeamMembers` | `TeamMembers.vue`ï¼ˆlazy loadï¼‰ | `requiresAuth: true`, `title: 'ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²'` |

**ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³:**
- ãƒˆãƒƒãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ ã‚·ãƒ¼ã‚ºãƒ³ãƒãƒ¼ã‚¿ãƒ«: ãƒãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§é·ç§»ï¼ˆ`has_season` ãŒtrueã®å ´åˆï¼‰
- ãƒãƒ¼ãƒ ä¸€è¦§ â†’ ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†: `mdi-account-group` ã‚¢ã‚¤ã‚³ãƒ³ã§ `/teams/:teamId/members` ã¸é·ç§»
- ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ â†’ é–¢é€£ç”»é¢: `TeamNavigation` ã‚¿ãƒ–ã§å‡ºå ´é¸æ‰‹ç™»éŒ²ãƒ»ã‚·ãƒ¼ã‚ºãƒ³ãƒãƒ¼ã‚¿ãƒ«ãƒ»é›¢è„±å±¥æ­´ã¸é·ç§»
- ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ â†’ å‰ç”»é¢: `router.back()` ã§ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯

---

## ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ä¸€è¦§

| ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ | ç¶™æ‰¿å…ƒ | å±æ€§ | é–¢é€£ | ç”¨é€” |
|-------------|--------|------|------|------|
| `TeamSerializer` | `ActiveModel::Serializer` | `id`, `name`, `short_name`, `is_active`, `has_season` | `has_one :director`, `has_many :coaches` | ãƒãƒ¼ãƒ ä¸€è¦§/è©³ç´° |
| `TeamPlayerSerializer` | `PlayerSerializer` | PlayerSerializerå±æ€§ + `selected_cost_type`, `current_cost`, `excluded_from_team_total` | ï¼ˆPlayerSerializerã® `has_many :cost_players`ï¼‰ | ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ï¼ˆã‚³ã‚¹ãƒˆæƒ…å ±ãƒ»é™¤å¤–ãƒ•ãƒ©ã‚°ä»˜ãï¼‰ |
| `TeamMembershipSerializer` | `ActiveModel::Serializer` | `id`, `team_id`, `player_id`, `squad`, `selected_cost_type`, `excluded_from_team_total` | `belongs_to :player` | ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç”¨ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ç®¡ç† |
| `TeamManagerSerializer` | `ActiveModel::Serializer` | `id`, `team_id`, `manager_id`, `role` | `belongs_to :manager` | ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç”¨ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ç®¡ç† |

**TeamSerializer ã® `has_season` ã‚«ã‚¹ã‚¿ãƒ å±æ€§:**
```ruby
def has_season
  object.season.present?
end
```

---

## æ—¢çŸ¥ã®åˆ¶ç´„ãƒ»æœªå®Ÿè£…æ©Ÿèƒ½

### 1. ãƒãƒ¼ãƒ å‰Šé™¤æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¸è¶³

**å•é¡Œ:** ãƒãƒ¼ãƒ ã«ç´ã¥ãã‚·ãƒ¼ã‚ºãƒ³ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€`Team#destroy` ã¯ `ActiveRecord::DeleteRestrictionError` ã‚’ç™ºç”Ÿã•ã›ã‚‹ãŒã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã“ã®ã‚¨ãƒ©ãƒ¼ã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦ã„ãªã„ã€‚

**å½±éŸ¿:** å‰Šé™¤å¤±æ•—æ™‚ã« 500 Internal Server Error ãŒè¿”å´ã•ã‚Œã‚‹ã€‚

**æ¨å¥¨å¯¾å¿œ:**
```ruby
def destroy
  @team.destroy
  head :no_content
rescue ActiveRecord::DeleteRestrictionError => e
  render json: { error: 'ã‚·ãƒ¼ã‚ºãƒ³ãŒç´ã¥ã„ã¦ã„ã‚‹ãŸã‚å‰Šé™¤ã§ãã¾ã›ã‚“' }, status: :unprocessable_entity
end
```

---

### 2. squad ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ã§å¤‰æ›´ä¸å¯

**å•é¡Œ:** `team_memberships.squad` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ã§ã¯ç·¨é›†ã§ããªã„ã€‚æ–°è¦è¿½åŠ ã•ã‚ŒãŸé¸æ‰‹ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ`"second"` = 2è»ï¼‰ã®ã¾ã¾ã€‚

**ä»•æ§˜:** `squad` ã¯ã‚·ãƒ¼ã‚ºãƒ³é‹å–¶ä¸­ã«ãƒ­ãƒ¼ã‚¹ã‚¿ãƒ¼ç®¡ç†ç”»é¢ã§å‹•çš„ã«å¤‰æ›´ã•ã‚Œã‚‹ã€‚ãƒãƒ¼ãƒ ä½œæˆæ™‚ã«ã¯è¨­å®šä¸è¦ã§ã‚ã‚Šã€ã“ã‚Œã¯æ„å›³çš„ãªä»•æ§˜ã€‚ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆ`commissioner/team_memberships#update`ï¼‰ã§ã¯ `squad` ã®æ›´æ–°ãŒå¯èƒ½ã€‚

---

### 3. ã‚³ã‚¹ãƒˆä¸€è¦§è¡¨é¸æŠãŒå¿…é ˆ

**ä»•æ§˜:** ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ã§ã¯ã€ã‚³ã‚¹ãƒˆä¸€è¦§è¡¨ã‚’é¸æŠã—ãªã„ã¨é¸æ‰‹ã®è¿½åŠ ãƒ»å–å¾—ãŒã§ããªã„ã€‚ã‚³ã‚¹ãƒˆç®¡ç†ãŒã‚·ã‚¹ãƒ†ãƒ ã®å¿…é ˆæ©Ÿèƒ½ã§ã‚ã‚‹ãŸã‚ã€ã“ã‚Œã¯ä»•æ§˜é€šã‚Šã®å‹•ä½œã€‚

---

## ã¾ã¨ã‚

ãƒãƒ¼ãƒ ç®¡ç†æ©Ÿèƒ½ã¯ã€ãƒãƒ¼ãƒ ã®åŸºæœ¬æƒ…å ±ï¼ˆåå‰ãƒ»ç•¥ç§°ãƒ»ç›£ç£ãƒ»ã‚³ãƒ¼ãƒãƒ»æ´»å‹•çŠ¶æ…‹ï¼‰ã®ç®¡ç†ã¨ã€ãƒãƒ¼ãƒ ã«æ‰€å±ã™ã‚‹é¸æ‰‹ï¼ˆãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ï¼‰ã®ç®¡ç†ã‚’çµ±åˆçš„ã«æä¾›ã™ã‚‹ã€‚

**ä¸»è¦ãªç‰¹å¾´:**
- ã‚«ãƒ¼ãƒ‰å‹ãƒãƒ¼ãƒ é¸æŠUIï¼ˆ`TopMenu`ï¼‰ã¨ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ
- ãƒãƒ¼ãƒ ä¸€è¦§ç”»é¢ã§ã®CRUDæ“ä½œï¼ˆ`TeamsController` 5ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã¨ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- TeamNavigationå…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ˆã‚‹ãƒãƒ¼ãƒ é–¢é€£ç”»é¢é–“ã®ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç·¨é›†ç”»é¢ã§ã®é¸æ‰‹è¿½åŠ ãƒ»å‰Šé™¤ã€ã‚³ã‚¹ãƒˆã‚¿ã‚¤ãƒ—é¸æŠã€é™¤å¤–ãƒ•ãƒ©ã‚°ï¼ˆ`TeamPlayersController` ä¸€æ‹¬æ›´æ–°æ–¹å¼ï¼‰
- å®ˆå‚™é©æ€§æƒ…å ±ä»˜ããƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ï¼ˆ`TeamMembershipsController`ï¼‰
- ç·ã‚³ã‚¹ãƒˆï¼ˆæœ€å¤§200ï¼‰ãƒ»äººæ•°åˆ¶é™ï¼ˆæœ€å¤§50äººï¼‰ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—ï¼ˆé™¤å¤–é¸æ‰‹ã‚’é™¤ãï¼‰
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã®ãƒãƒ¼ãƒ åˆè¨ˆã‚³ã‚¹ãƒˆä¸Šé™ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- å¤–ã®ä¸–ç•Œæ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæœ€å¤§4äººã€æŠ•æ‰‹/é‡æ‰‹æ··åœ¨ãƒã‚§ãƒƒã‚¯ï¼‰
- ç›£ç£ãƒ»ã‚³ãƒ¼ãƒã®è¤‡æ•°ç®¡ç†ï¼ˆ`team_managers` ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ« + `TeamManager` ãƒ¢ãƒ‡ãƒ«ï¼‰
- åŒä¸€ãƒªãƒ¼ã‚°å†…ã§ã®ç›£ç£/ã‚³ãƒ¼ãƒå…¼ä»»ç¦æ­¢ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒŠãƒ¼ç”¨ã®å€‹åˆ¥CRUDç®¡ç†ï¼ˆ`commissioner/team_memberships`, `commissioner/team_managers`ï¼‰
- Vue 3 Composition API + Vuetify 3 ã«ã‚ˆã‚‹ãƒªãƒƒãƒUIï¼ˆ`v-data-table`, `v-autocomplete`, `v-dialog`ï¼‰

**æ—¢çŸ¥ã®èª²é¡Œ:**
- ãƒãƒ¼ãƒ å‰Šé™¤æ™‚ã® `DeleteRestrictionError` ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æœªå®Ÿè£…
